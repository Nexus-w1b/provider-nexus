<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Virza Nexus</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --accent: #6366f1; --bg: #020617; }
        body { background: var(--bg); color: #f8fafc; font-family: 'Plus Jakarta Sans', sans-serif; overflow: hidden; }
        .glass { background: rgba(15, 23, 42, 0.85); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .workspace-layout { display: flex; flex-direction: column; height: calc(100vh - 100px); }
        @media (min-width: 1024px) { .workspace-layout { display: grid; grid-template-columns: 450px 1fr; } }
        
        .portal-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; background: rgba(30, 41, 59, 0.3); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 2rem; }
        .portal-card:hover { border-color: var(--accent); transform: translateY(-3px); background: rgba(99, 102, 241, 0.1); }
        
        #canvasFrame { background: white; border-radius: 1.5rem; width: 100%; height: 100%; border: none; }
        .sidebar-settings { transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1); background: #020617; z-index: 1200; box-shadow: -20px 0 60px rgba(0,0,0,0.8); }
        
        .history-item { transition: all 0.2s; border-left: 2px solid transparent; }
        .history-item:hover { background: rgba(99, 102, 241, 0.1); border-left-color: var(--accent); }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .loading-screen { position: fixed; inset: 0; background: #020617; z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        .gps-badge { font-size: 8px; font-weight: 800; padding: 2px 8px; border-radius: 4px; display: inline-flex; align-items: center; gap: 4px; }
    </style>
</head>
<body class="h-screen flex flex-col">

    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="w-16 h-16 border-4 border-indigo-500/20 border-t-indigo-500 rounded-full animate-spin"></div>
        <h2 class="mt-6 text-xs font-black italic tracking-tighter uppercase">NEXUS <span class="text-indigo-500">V12</span></h2>
    </div>

    <!-- Auth Page -->
    <div id="authPage" class="fixed inset-0 z-[1100] hidden flex items-center justify-center p-6 bg-slate-950">
        <div class="w-full max-w-md glass p-10 rounded-[40px]">
            <h1 class="text-2xl font-black italic text-center mb-8 uppercase">VIRZA <span class="text-indigo-500">NEXUS</span></h1>
            <div class="space-y-4">
                <input type="email" id="email" class="w-full p-4 bg-white/5 rounded-2xl border border-white/10 text-sm outline-none focus:border-indigo-500" placeholder="Email">
                <input type="password" id="password" class="w-full p-4 bg-white/5 rounded-2xl border border-white/10 text-sm outline-none focus:border-indigo-500" placeholder="Password">
                <button onclick="handleAuth()" class="w-full py-4 bg-indigo-600 rounded-2xl font-black text-xs uppercase tracking-widest">Akses dashboard</button>
            </div>
        </div>
    </div>

    <div id="appContent" class="hidden h-full flex flex-col">
        <header class="w-full p-6 flex justify-between items-center z-50 border-b border-white/5 h-24 glass">
            <div class="flex items-center gap-4">
                <button id="backBtn" onclick="goToLobby()" class="hidden w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center border border-white/10">
                    <i class="fa-solid fa-arrow-left text-xs"></i>
                </button>
                <div class="flex flex-col">
                    <div class="flex items-center gap-2">
                        <div id="gpsStatus" class="gps-badge bg-red-500/10 text-red-500">
                            <i class="fa-solid fa-location-crosshairs"></i> GPS OFFLINE
                        </div>
                        <span id="locationName" class="text-[9px] font-black text-slate-500 uppercase tracking-widest">Searching...</span>
                    </div>
                    <div id="fullDate" class="text-[9px] font-black text-indigo-400 uppercase tracking-widest mt-1">MEMUAT...</div>
                    <span id="liveClock" class="text-xl font-black italic tracking-tighter">00:00:00</span>
                </div>
            </div>

            <div class="flex items-center gap-4">
                <div onclick="toggleSidebar()" class="w-11 h-11 rounded-full bg-indigo-600 flex items-center justify-center font-black border-2 border-white/10 cursor-pointer overflow-hidden shadow-lg shadow-indigo-500/20 active:scale-90 transition">
                    <span id="userInitial">V</span>
                </div>
                <button onclick="toggleSidebar()" class="w-11 h-11 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center text-slate-400">
                    <i class="fa-solid fa-sliders-h"></i>
                </button>
            </div>
        </header>
        
        <main class="flex-1 overflow-hidden relative">
            <div id="lobby" class="absolute inset-0 overflow-y-auto p-6 no-scrollbar">
                <div class="max-w-6xl mx-auto py-4 space-y-6 text-center">
                    <h2 class="text-4xl font-black italic tracking-tighter">HI, <span id="welcomeName" class="text-indigo-500 uppercase">COMMANDER</span></h2>
                    <div class="relative max-w-xl mx-auto">
                        <i class="fa-solid fa-search absolute left-6 top-1/2 -translate-y-1/2 text-slate-500"></i>
                        <input type="text" id="portalSearch" oninput="filterPortals()" class="w-full bg-white/5 border border-white/10 p-5 pl-14 rounded-full text-sm outline-none focus:border-indigo-500" placeholder="Cari Dimensi...">
                    </div>
                </div>
                <div id="portalGrid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4 mt-8 max-w-6xl mx-auto"></div>
            </div>
            <div id="workspace" class="hidden absolute inset-0 workspace-layout">
                <div class="flex flex-col border-r border-white/5 bg-slate-950/50">
                    <div id="chatHistory" class="flex-1 overflow-y-auto p-6 space-y-4 no-scrollbar"></div>
                    <div class="p-4 bg-slate-900 border-t border-white/5 space-y-3">
                        <textarea id="aiInput" class="w-full bg-white/5 border border-white/10 rounded-2xl p-4 text-xs text-white placeholder-slate-600 outline-none focus:border-indigo-500 resize-none" rows="2" placeholder="Input neural data..."></textarea>
                        <button onclick="executeAI()" class="w-full py-4 bg-indigo-600 rounded-xl font-black text-[10px] uppercase tracking-widest active:scale-95 transition">Execute Portal</button>
                    </div>
                </div>
                <div class="relative bg-slate-950 p-4 h-full overflow-hidden">
                    <div class="glass rounded-[2rem] overflow-hidden h-full">
                        <iframe id="canvasFrame" sandbox="allow-scripts allow-modals"></iframe>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <aside id="sidebar" class="sidebar-settings fixed inset-y-0 right-0 w-80 translate-x-full p-8 flex flex-col border-l border-white/10">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-black italic tracking-tighter uppercase">NEXUS <span class="text-indigo-500">ID</span></h2>
            <button onclick="toggleSidebar()" class="text-slate-500"><i class="fa-solid fa-xmark"></i></button>
        </div>
        
        <div class="flex-1 overflow-y-auto no-scrollbar space-y-8">
            <div class="space-y-4">
                <label class="text-[10px] font-black text-slate-500 uppercase tracking-widest">account settings</label>
                <div class="space-y-2">
                    <div class="flex items-center gap-3 p-4 bg-indigo-600/10 border border-indigo-500/30 rounded-2xl">
                        <div class="w-10 h-10 rounded-full bg-indigo-500 flex items-center justify-center font-bold text-xs" id="sideInitial">V</div>
                        <div class="flex-1 overflow-hidden">
                            <p id="sideUserName" class="text-xs font-black truncate">Commander</p>
                            <p class="text-[8px] font-bold text-indigo-400 uppercase tracking-widest">Primary Identify</p>
                        </div>
                    </div>
                    <button onclick="alert('Sinkronisasi Akun Kedua...')" class="w-full p-3 border-2 border-dashed border-white/10 rounded-2xl text-[9px] font-black uppercase tracking-widest text-slate-500 hover:text-white transition">
                        + Tambah Akun
                    </button>
                </div>
            </div>

            <div class="space-y-4">
                <label class="text-[10px] font-black text-slate-500 uppercase tracking-widest"> nexus History</label>
                <div id="neuralHistoryList" class="space-y-2">
                    <div class="text-[9px] text-slate-600 text-center py-4 italic">Memproses riwayat cloud...</div>
                </div>
            </div
            <div class="space-y-4">
                <label class="text-[10px] font-black text-slate-500 uppercase tracking-widest">system pikey</label>
                <input type="password" id="apiKey" class="w-full bg-slate-950 p-4 rounded-xl border border-white/10 text-xs text-white" placeholder="Key Gemini...">
                <button onclick="saveSettings()" class="w-full py-4 bg-indigo-600 text-white rounded-xl font-black text-[10px] uppercase shadow-lg shadow-indigo-500/20">Sync Neural</button>
            </div>
        </div>

        <div class="pt-6">
            <button onclick="handleLogout()" class="w-full py-4 bg-red-500/10 text-red-500 rounded-xl font-black text-[10px] uppercase border border-red-500/20">Logout Nexus</button>
        </div>
    </aside>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, addDoc, query, onSnapshot, serverTimestamp, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBK-MehTTzURY5jT5stH363Y5_WE4iy-XA",
            authDomain: "volca-tools.firebaseapp.com",
            projectId: "volca-tools",
            storageBucket: "volca-tools.firebasestorage.app",
            messagingSenderId: "262525907487",
            appId: "1:262525907487:web:4abc37fa3b583223569b2a"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        onAuthStateChanged(auth, async (user) => {
            const ls = document.getElementById('loadingScreen');
            const ap = document.getElementById('authPage');
            const content = document.getElementById('appContent');
            
            if(user) {
                const name = user.displayName || user.email.split('@')[0];
                const initial = name.charAt(0).toUpperCase();
                document.getElementById('welcomeName').innerText = name.toUpperCase();
                document.getElementById('userInitial').innerText = initial;
                document.getElementById('sideInitial').innerText = initial;
                document.getElementById('sideUserName').innerText = name;
                
                ap.style.display = 'none';
                content.style.display = 'flex';

                const vault = await getDoc(doc(db, 'artifacts', 'virza-v12', 'users', user.uid, 'settings', 'vault'));
                if(vault.exists()) {
                    const key = vault.data().gemini;
                    document.getElementById('apiKey').value = key;
                    localStorage.setItem('virza_v12_key', key);
                }
                loadNeuralHistory(user.uid);
            } else {
                ap.style.display = 'flex';
                content.style.display = 'none';
            }
            setTimeout(() => { ls.style.opacity = '0'; setTimeout(() => ls.style.display = 'none', 500); }, 800);
        });

        async function loadNeuralHistory(uid) {
            const q = query(collection(db, 'artifacts', 'virza-v12', 'users', uid, 'history'), orderBy('timestamp', 'desc'), limit(15));
            onSnapshot(q, (snap) => {
                const list = document.getElementById('neuralHistoryList');
                list.innerHTML = "";
                snap.forEach(d => {
                    const m = d.data();
                    const date = m.timestamp ? m.timestamp.toDate() : new Date();
                    const days = ["MINGGU", "SENIN", "SELASA", "RABU", "KAMIS", "JUMAT", "SABTU"];
                    const dayLabel = days[date.getDay()];
                    const dateStr = `${date.getDate()}/${date.getMonth()+1}/${date.getFullYear()}`;
                    
                    list.innerHTML += `
                        <div class="history-item p-3 rounded-xl bg-white/5 border border-white/5 cursor-pointer">
                            <div class="flex justify-between items-start mb-1">
                                <span class="text-[7px] font-black text-indigo-400 uppercase tracking-widest">${dayLabel} | ${dateStr}</span>
                                <span class="text-[7px] font-black text-slate-500 uppercase">${m.portal || 'GENERAL'}</span>
                            </div>
                            <p class="text-[10px] text-slate-300 truncate font-bold uppercase tracking-tighter italic">"${m.prompt}"</p>
                        </div>
                    `;
                });
            });
        }

        window.handleAuth = () => {
            const e = document.getElementById('email').value;
            const p = document.getElementById('password').value;
            signInWithEmailAndPassword(auth, e, p).catch(err => alert(err.message));
        };
        window.handleLogout = () => signOut(auth);
        window.saveSettings = async () => {
            const key = document.getElementById('apiKey').value;
            if(auth.currentUser) {
                await setDoc(doc(db, 'artifacts', 'virza-v12', 'users', auth.currentUser.uid, 'settings', 'vault'), { gemini: key });
                localStorage.setItem('virza_v12_key', key);
                alert("Cloud Sync Complete!");
                window.toggleSidebar();
            }
        };

        window.executeAI = async () => {
            const prompt = document.getElementById('aiInput').value;
            const key = localStorage.getItem('virza_v12_key');
            if(!prompt || !key) return alert("Missing API Key!");

            const chat = document.getElementById('chatHistory');
            chat.innerHTML += `<div class="p-4 bg-indigo-600 text-white rounded-2xl rounded-br-none ml-auto text-xs max-w-[85%] mb-4">${prompt}</div>`;
            document.getElementById('aiInput').value = "";

            try {
                if(auth.currentUser) {
                    await addDoc(collection(db, 'artifacts', 'virza-v12', 'users', auth.currentUser.uid, 'history'), {
                        prompt, portal: window.activePortal || 'GENERAL', timestamp: serverTimestamp()
                    });
                }
                
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${key}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await res.json();
                const text = data.candidates[0].content.parts[0].text;
                chat.innerHTML += `<div class="p-4 bg-white/5 border border-white/5 rounded-2xl rounded-bl-none text-xs text-slate-300 max-w-[85%] mb-4">${text}</div>`;
                
                const codeMatch = text.match(/```html?([\s\S]*?)```/);
                if(codeMatch) {
                    const blob = new Blob([codeMatch[1].trim()], { type: 'text/html' });
                    document.getElementById('canvasFrame').src = URL.createObjectURL(blob);
                }
            } catch (err) { alert("Signal Lost. Check Key."); }
            chat.scrollTop = chat.scrollHeight;
        };
    </script>

    <script>
        function initGlobalSystems() {
            const updateClock = () => {
                const now = new Date();
                const days = ["MINGGU", "SENIN", "SELASA", "RABU", "KAMIS", "JUMAT", "SABTU"];
                const months = ["JAN", "FEB", "MAR", "APR", "MEI", "JUN", "JUL", "AGU", "SEP", "OKT", "NOV", "DES"];
                
                document.getElementById('fullDate').innerText = `${days[now.getDay()]}, ${now.getDate()} ${months[now.getMonth()]} ${now.getFullYear()}`;
                document.getElementById('liveClock').innerText = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
                setTimeout(updateClock, 1000);
            };
            updateClock()
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition((pos) => {
                    const badge = document.getElementById('gpsStatus');
                    badge.classList.remove('bg-red-500/10', 'text-red-500');
                    badge.classList.add('bg-green-500/10', 'text-green-500');
                    badge.innerHTML = `<i class="fa-solid fa-satellite-dish"></i> GPS ACTIVE`;
                    const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
                    document.getElementById('locationName').innerText = tz.split('/').pop().replace('_', ' ') + " PORT";
                }, () => {
                    document.getElementById('locationName').innerText = "LOCATION BLOCKED";
                });
            }
        }
        initGlobalSystems();

        const portals = [
            { id: 'coding', name: 'Architect', icon: 'fa-code' },
            { id: 'image', name: 'Image HD', icon: 'fa-image' },
            { id: 'chat', name: 'Smart AI', icon: 'fa-comment' },
            { id: 'vision', name: 'Vision Pro', icon: 'fa-eye' },
            { id: 'web', name: 'Web Weaver', icon: 'fa-globe' },
            { id: 'cyber', name: 'Cyber Guard', icon: 'fa-shield' },
            { id: 'math', name: 'Quantum', icon: 'fa-calculator' },
            { id: 'seo', name: 'SEO Master', icon: 'fa-magnifying-glass' },
            { id: 'data', name: 'Data Miner', icon: 'fa-database' },
            { id: 'social', name: 'Social Ads', icon: 'fa-hashtag' },
            { id: 'video', name: 'Motion AI', icon: 'fa-film' },
            { id: 'audio', name: 'Sonic Wave', icon: 'fa-music' },
            { id: 'logo', name: 'Brand AI', icon: 'fa-pen-nib' },
            { id: 'lang', name: 'Polyglot', icon: 'fa-language' },
            { id: 'bug', name: 'Debug Sys', icon: 'fa-bug' },
            { id: 'cloud', name: 'Cloud Drive', icon: 'fa-cloud' },
            { id: 'sec', name: 'Vault Pro', icon: 'fa-key' },
            { id: 'write', name: 'Ghost Writer', icon: 'fa-book' },
            { id: 'game', name: 'Game Dev', icon: 'fa-gamepad' },
            { id: 'law', name: 'Law Logic', icon: 'fa-gavel' }
        ];

        function renderPortals(list) {
            const grid = document.getElementById('portalGrid');
            grid.innerHTML = (list || portals).map(p => `
                <div onclick="enterPortal('${p.id}', '${p.name}')" class="portal-card p-6 flex flex-col items-center gap-3">
                    <div class="w-12 h-12 bg-indigo-500/10 rounded-2xl flex items-center justify-center text-indigo-400 text-xl border border-white/5">
                        <i class="fa-solid ${p.icon}"></i>
                    </div>
                    <span class="text-[8px] font-black uppercase tracking-widest text-slate-400">${p.name}</span>
                </div>
            `).join('');
        }
        renderPortals();

        window.toggleSidebar = () => document.getElementById('sidebar').classList.toggle('translate-x-full');
        window.enterPortal = (id, name) => {
            window.activePortal = id;
            document.getElementById('lobby').classList.add('hidden');
            document.getElementById('workspace').classList.remove('hidden');
            document.getElementById('backBtn').classList.remove('hidden');
        };
        window.goToLobby = () => {
            document.getElementById('lobby').classList.remove('hidden');
            document.getElementById('workspace').classList.add('hidden');
            document.getElementById('backBtn').classList.add('hidden');
        };
        window.filterPortals = () => {
            const q = document.getElementById('portalSearch').value.toLowerCase();
            renderPortals(portals.filter(p => p.name.toLowerCase().includes(q)));
        };
    </script>
</body>
</html>
