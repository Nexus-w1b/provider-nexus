<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Virza Nexus</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Exo+2:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --accent: #00f0ff;
            --accent-2: #ff3366;
            --accent-3: #00ff88;
            --bg-deep: #020810;
            --bg-mid: #0a1525;
            --success: #00ff88;
            --warning: #ffc107;
            --danger: #ff3366;
            --gold: #ffd700;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background: var(--bg-deep);
            color: #e8f4f8;
            font-family: 'Exo 2', sans-serif;
            overflow: hidden;
            height: 100vh;
            height: 100dvh;
        }

        .space-bg {
            position: fixed;
            inset: 0;
            z-index: 0;
            background:
                radial-gradient(ellipse at 15% 85%, rgba(0, 240, 255, 0.08) 0%, transparent 45%),
                radial-gradient(ellipse at 85% 15%, rgba(255, 51, 102, 0.06) 0%, transparent 45%),
                radial-gradient(ellipse at 50% 50%, rgba(0, 255, 136, 0.04) 0%, transparent 60%),
                linear-gradient(180deg, #020810 0%, #0a1525 40%, #051018 100%);
        }

        .nebula {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            animation: nebulaFloat 20s ease-in-out infinite;
        }
        @keyframes nebulaFloat {
            0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.4; }
            33% { transform: translate(30px, -20px) scale(1.1); opacity: 0.6; }
            66% { transform: translate(-20px, 30px) scale(0.95); opacity: 0.5; }
        }

        .stars-container {
            position: absolute;
            inset: 0;
            overflow: hidden;
        }
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
        }
        .star-tiny { animation: twinkleTiny 4s ease-in-out infinite; }
        .star-small { animation: twinkleSmall 3s ease-in-out infinite; }
        .star-medium { animation: twinkleMedium 2.5s ease-in-out infinite; }
        .star-large { animation: twinkleLarge 2s ease-in-out infinite; }

        @keyframes twinkleTiny { 0%, 100% { opacity: 0.2; } 50% { opacity: 0.6; } }
        @keyframes twinkleSmall { 0%, 100% { opacity: 0.3; transform: scale(1); } 50% { opacity: 0.8; transform: scale(1.3); } }
        @keyframes twinkleMedium { 0%, 100% { opacity: 0.4; transform: scale(1); } 50% { opacity: 1; transform: scale(1.5); } }
        @keyframes twinkleLarge { 0%, 100% { opacity: 0.5; transform: scale(1); } 50% { opacity: 1; transform: scale(1.8); } }

        .shooting-star {
            position: absolute;
            width: 120px;
            height: 2px;
            background: linear-gradient(90deg, rgba(255,255,255,0.9), rgba(0,240,255,0.5), transparent);
            animation: shootingStar 5s ease-out infinite;
            opacity: 0;
            border-radius: 2px;
        }
        @keyframes shootingStar {
            0% { transform: translateX(0) translateY(0) rotate(-35deg); opacity: 0; }
            5% { opacity: 1; }
            20% { transform: translateX(-400px) translateY(280px) rotate(-35deg); opacity: 0; }
            100% { opacity: 0; }
        }

        .orbit-ring {
            position: absolute;
            border: 1px solid rgba(0, 240, 255, 0.1);
            border-radius: 50%;
            animation: orbitRotate 60s linear infinite;
        }
        @keyframes orbitRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .orbit-dot {
            position: absolute;
            width: 6px;
            height: 6px;
            background: var(--accent);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--accent);
        }

        .loading-screen {
            position: fixed;
            inset: 0;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background:
                radial-gradient(ellipse at center, rgba(0, 240, 255, 0.03) 0%, transparent 50%),
                linear-gradient(180deg, #020810 0%, #0a1525 50%, #020810 100%);
            transition: opacity 0.8s ease-out, visibility 0.8s;
        }
        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .spaceship-wrapper {
            perspective: 1200px;
            transform-style: preserve-3d;
        }

        .spaceship-4d {
            position: relative;
            width: 140px;
            height: 240px;
            transform-style: preserve-3d;
            animation: shipFloat 5s ease-in-out infinite, shipEnter 2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes shipEnter {
            0% {
                transform: translateY(200px) scale(0.3) rotateX(-30deg);
                opacity: 0;
            }
            40% {
                transform: translateY(-30px) scale(1.1) rotateX(5deg);
                opacity: 1;
            }
            70% {
                transform: translateY(10px) scale(0.98) rotateX(-2deg);
            }
            100% {
                transform: translateY(0) scale(1) rotateX(0deg);
                opacity: 1;
            }
        }

        @keyframes shipFloat {
            0%, 100% { transform: translateY(0) rotateY(0deg) rotateX(0deg); }
            25% { transform: translateY(-20px) rotateY(8deg) rotateX(3deg); }
            50% { transform: translateY(-10px) rotateY(0deg) rotateX(-2deg); }
            75% { transform: translateY(-25px) rotateY(-8deg) rotateX(2deg); }
        }

        .rocket-main-body {
            position: absolute;
            left: 50%;
            top: 50px;
            transform: translateX(-50%);
            width: 60px;
            height: 140px;
            background: linear-gradient(90deg,
                #1a2a40 0%,
                #2a4060 20%,
                #4a6a8a 40%,
                #8ab4d4 50%,
                #4a6a8a 60%,
                #2a4060 80%,
                #1a2a40 100%
            );
            border-radius: 50% 50% 25% 25% / 60% 60% 15% 15%;
            box-shadow:
                inset -10px 0 30px rgba(0,0,0,0.5),
                inset 10px 0 20px rgba(255,255,255,0.1),
                0 20px 60px rgba(0, 240, 255, 0.25),
                0 0 100px rgba(0, 240, 255, 0.1);
        }

        .rocket-nose-cone {
            position: absolute;
            left: 50%;
            top: 0;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 30px solid transparent;
            border-right: 30px solid transparent;
            border-bottom: 60px solid #d42c2c;
            filter: drop-shadow(0 -10px 20px rgba(212, 44, 44, 0.5));
        }
        .rocket-nose-cone::before {
            content: '';
            position: absolute;
            top: 15px;
            left: -18px;
            width: 36px;
            height: 45px;
            background: linear-gradient(180deg, #ff6b6b, #e63946 40%, #d42c2c);
            border-radius: 50% 50% 40% 40%;
        }
        .rocket-nose-cone::after {
            content: '';
            position: absolute;
            top: 8px;
            left: -10px;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #fff 0%, #ff6b6b 100%);
            border-radius: 50%;
            opacity: 0.8;
        }

        .rocket-window {
            position: absolute;
            left: 50%;
            top: 75px;
            transform: translateX(-50%);
            width: 30px;
            height: 30px;
            background:
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9), transparent 50%),
                radial-gradient(circle, #00f0ff 0%, #0088aa 60%, #004466 100%);
            border-radius: 50%;
            border: 4px solid #2a4060;
            box-shadow:
                inset 0 0 15px rgba(0, 240, 255, 0.6),
                0 0 30px rgba(0, 240, 255, 0.8);
            animation: windowGlow 2s ease-in-out infinite;
        }
        @keyframes windowGlow {
            0%, 100% { box-shadow: inset 0 0 15px rgba(0, 240, 255, 0.6), 0 0 30px rgba(0, 240, 255, 0.8); }
            50% { box-shadow: inset 0 0 20px rgba(0, 240, 255, 0.8), 0 0 50px rgba(0, 240, 255, 1); }
        }

        .rocket-stripe {
            position: absolute;
            left: 50%;
            top: 130px;
            transform: translateX(-50%);
            width: 60px;
            height: 10px;
            background: linear-gradient(90deg, #1a2a40, #d42c2c 15%, #d42c2c 85%, #1a2a40);
            border-radius: 3px;
        }

        .fin-left, .fin-right {
            position: absolute;
            bottom: 30px;
        }
        .fin-left {
            left: 5px;
            width: 0;
            height: 0;
            border-right: 35px solid #b82828;
            border-top: 20px solid transparent;
            border-bottom: 50px solid transparent;
            transform: rotate(-12deg);
        }
        .fin-left::after {
            content: '';
            position: absolute;
            top: -15px;
            left: 8px;
            width: 0;
            height: 0;
            border-right: 28px solid #d42c2c;
            border-top: 15px solid transparent;
            border-bottom: 40px solid transparent;
        }
        .fin-right {
            right: 5px;
            width: 0;
            height: 0;
            border-left: 35px solid #b82828;
            border-top: 20px solid transparent;
            border-bottom: 50px solid transparent;
            transform: rotate(12deg);
        }
        .fin-right::after {
            content: '';
            position: absolute;
            top: -15px;
            right: 8px;
            width: 0;
            height: 0;
            border-left: 28px solid #d42c2c;
            border-top: 15px solid transparent;
            border-bottom: 40px solid transparent;
        }

        .rocket-engine {
            position: absolute;
            left: 50%;
            bottom: 0;
            transform: translateX(-50%);
            width: 45px;
            height: 30px;
            background: linear-gradient(180deg, #4a5568 0%, #2d3748 50%, #1a202c 100%);
            border-radius: 0 0 45% 45% / 0 0 100% 100%;
            box-shadow: inset 0 -8px 20px rgba(0,0,0,0.9);
        }

        .flame-container {
            position: absolute;
            left: 50%;
            bottom: -65px;
            transform: translateX(-50%);
            display: flex;
            justify-content: center;
            filter: blur(0.5px);
        }
        .flame {
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
        }
        .flame-outer {
            width: 45px;
            height: 80px;
            background: linear-gradient(180deg, #ff8c00 0%, #ff6600 30%, #ff3300 60%, #cc0000 100%);
            box-shadow: 0 0 40px #ff3300, 0 0 80px #ff6600;
            animation: flameOuterAnim 0.1s ease-in-out infinite alternate;
        }
        .flame-middle {
            position: absolute;
            bottom: 8px;
            width: 30px;
            height: 60px;
            background: linear-gradient(180deg, #ffcc00 0%, #ff9900 50%, #ff6600 100%);
            box-shadow: 0 0 30px #ffcc00, 0 0 60px #ff9900;
            animation: flameMiddleAnim 0.08s ease-in-out infinite alternate;
        }
        .flame-inner {
            position: absolute;
            bottom: 12px;
            width: 16px;
            height: 40px;
            background: linear-gradient(180deg, #ffffff 0%, #fffacd 40%, #ffcc00 100%);
            box-shadow: 0 0 20px #ffffff, 0 0 40px #fffacd;
            animation: flameInnerAnim 0.06s ease-in-out infinite alternate;
        }

        @keyframes flameOuterAnim { 0% { transform: scaleY(1) scaleX(1); } 100% { transform: scaleY(1.2) scaleX(0.9); } }
        @keyframes flameMiddleAnim { 0% { transform: scaleY(1) scaleX(1); } 100% { transform: scaleY(1.15) scaleX(0.92); } }
        @keyframes flameInnerAnim { 0% { transform: scaleY(1); } 100% { transform: scaleY(1.1); } }

        .flame-glow-effect {
            position: absolute;
            left: 50%;
            bottom: -80px;
            transform: translateX(-50%);
            width: 120px;
            height: 120px;
            background: radial-gradient(ellipse at center top, rgba(255, 150, 0, 0.6) 0%, rgba(255, 100, 0, 0.3) 30%, transparent 70%);
            animation: glowPulseAnim 0.3s ease-in-out infinite alternate;
            pointer-events: none;
        }
        @keyframes glowPulseAnim {
            0% { opacity: 0.7; transform: translateX(-50%) scale(1); }
            100% { opacity: 1; transform: translateX(-50%) scale(1.2); }
        }

        .smoke-area {
            position: absolute;
            left: 50%;
            bottom: -100px;
            transform: translateX(-50%);
            width: 80px;
            height: 100px;
            pointer-events: none;
        }
        .smoke-p {
            position: absolute;
            background: radial-gradient(circle, rgba(255,255,255,0.35) 0%, transparent 70%);
            border-radius: 50%;
            animation: smokeRise 2.5s ease-out infinite;
        }
        @keyframes smokeRise {
            0% { transform: translateY(0) scale(0.4); opacity: 0.5; }
            100% { transform: translateY(100px) scale(2.5); opacity: 0; }
        }

        .loading-content {
            margin-top: 120px;
            text-align: center;
            opacity: 0;
            animation: fadeInContent 1s ease-out 2s forwards;
        }
        @keyframes fadeInContent {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .loading-brand {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            font-weight: 900;
            letter-spacing: 0.3em;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-3) 50%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: none;
            filter: drop-shadow(0 0 30px rgba(0, 240, 255, 0.5));
            animation: brandPulse 3s ease-in-out infinite;
        }
        @keyframes brandPulse {
            0%, 100% { filter: drop-shadow(0 0 30px rgba(0, 240, 255, 0.5)); }
            50% { filter: drop-shadow(0 0 50px rgba(0, 240, 255, 0.8)); }
        }

        .loading-tagline {
            font-size: 0.65rem;
            color: #5a7a8a;
            margin-top: 0.75rem;
            letter-spacing: 0.5em;
            text-transform: uppercase;
        }

        .progress-container {
            width: 260px;
            height: 4px;
            background: rgba(0, 240, 255, 0.1);
            border-radius: 2px;
            margin: 1.75rem auto;
            overflow: hidden;
            border: 1px solid rgba(0, 240, 255, 0.2);
            opacity: 0;
            animation: fadeInContent 1s ease-out 2.3s forwards;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--accent-3), var(--accent));
            background-size: 200% 100%;
            animation: progressFill 5s ease-out forwards, progressShine 2s linear infinite;
            box-shadow: 0 0 20px var(--accent);
        }
        @keyframes progressFill {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        @keyframes progressShine {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .status-container {
            height: 28px;
            opacity: 0;
            animation: fadeInContent 1s ease-out 2.6s forwards;
        }
        .status-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.7rem;
            color: var(--accent);
            letter-spacing: 0.2em;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .status-text.active { opacity: 1; }

        .auth-screen {
            position: fixed;
            inset: 0;
            z-index: 100;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .station-panel {
            position: relative;
            width: 100%;
            max-width: 420px;
            padding: 2.5rem 2rem;
            background: linear-gradient(145deg, rgba(10, 21, 37, 0.95), rgba(2, 8, 16, 0.98));
            border: 1px solid rgba(0, 240, 255, 0.25);
            border-radius: 1.5rem;
            box-shadow:
                0 0 60px rgba(0, 240, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            overflow: hidden;
        }

        .station-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--accent), var(--accent-3), var(--accent), transparent);
        }

        .station-panel::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        }

        .corner-frame {
            position: absolute;
            width: 30px;
            height: 30px;
            border: 2px solid var(--accent);
            opacity: 0.5;
        }
        .corner-frame.tl { top: 10px; left: 10px; border-right: none; border-bottom: none; }
        .corner-frame.tr { top: 10px; right: 10px; border-left: none; border-bottom: none; }
        .corner-frame.bl { bottom: 10px; left: 10px; border-right: none; border-top: none; }
        .corner-frame.br { bottom: 10px; right: 10px; border-left: none; border-top: none; }

        .station-logo-wrap {
            width: 70px;
            height: 70px;
            margin: 0 auto 1.5rem;
            position: relative;
        }

        .station-logo-inner {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--accent), var(--accent-3));
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 40px rgba(0, 240, 255, 0.4);
            animation: logoSpin 20s linear infinite;
        }
        @keyframes logoSpin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .station-logo-inner i {
            font-size: 1.75rem;
            color: white;
            animation: logoSpin 20s linear infinite reverse;
        }
        .station-logo-ring {
            position: absolute;
            inset: -10px;
            border: 2px solid var(--accent);
            border-radius: 50%;
            opacity: 0.4;
            animation: ringPulseAnim 3s ease-in-out infinite;
        }
        .station-logo-ring-2 {
            position: absolute;
            inset: -18px;
            border: 1px solid var(--accent-3);
            border-radius: 50%;
            opacity: 0.2;
            animation: ringPulseAnim 3s ease-in-out infinite 0.5s;
        }
        @keyframes ringPulseAnim {
            0%, 100% { transform: scale(1); opacity: 0.4; }
            50% { transform: scale(1.1); opacity: 0.2; }
        }

        .station-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            font-weight: 900;
            text-align: center;
            letter-spacing: 0.15em;
            margin-bottom: 0.25rem;
        }
        .station-title span { color: var(--accent); }

        .station-subtitle {
            font-size: 0.6rem;
            text-align: center;
            color: #5a7a8a;
            text-transform: uppercase;
            letter-spacing: 0.4em;
            margin-bottom: 2rem;
        }

        .input-field {
            position: relative;
            margin-bottom: 1rem;
        }
        .input-field i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--accent);
            opacity: 0.7;
            font-size: 0.9rem;
        }
        .input-field input {
            width: 100%;
            padding: 0.875rem 1rem 0.875rem 2.75rem;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 240, 255, 0.15);
            border-radius: 0.75rem;
            color: white;
            font-size: 0.85rem;
            outline: none;
            transition: all 0.3s;
            font-family: 'Exo 2', sans-serif;
        }
        .input-field input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.15);
        }
        .input-field input::placeholder { color: #4a6a7a; }

        .btn-primary {
            width: 100%;
            padding: 0.875rem;
            background: linear-gradient(135deg, var(--accent), var(--accent-3));
            border: none;
            border-radius: 0.75rem;
            color: #020810;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 0 30px rgba(0, 240, 255, 0.3);
            margin-top: 0.5rem;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 40px rgba(0, 240, 255, 0.5);
        }
        .btn-primary:active { transform: scale(0.98); }

        .btn-secondary {
            width: 100%;
            padding: 0.75rem;
            background: rgba(0, 240, 255, 0.08);
            border: 1px solid rgba(0, 240, 255, 0.2);
            border-radius: 0.75rem;
            color: var(--accent);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-family: 'Exo 2', sans-serif;
        }
        .btn-secondary:hover { background: rgba(0, 240, 255, 0.12); }

        .btn-anonymous {
            background: rgba(0, 255, 136, 0.08);
            border-color: rgba(0, 255, 136, 0.2);
            color: var(--accent-3);
        }
        .btn-anonymous:hover { background: rgba(0, 255, 136, 0.12); }

        .divider-line {
            display: flex;
            align-items: center;
            margin: 1.25rem 0;
        }
        .divider-line span {
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(0, 240, 255, 0.2), transparent);
        }
        .divider-line p {
            padding: 0 1rem;
            font-size: 0.6rem;
            color: #4a6a7a;
            text-transform: uppercase;
            letter-spacing: 0.2em;
        }

        .auth-switch {
            text-align: center;
            margin-top: 1rem;
        }
        .auth-switch button {
            background: none;
            border: none;
            color: var(--accent);
            font-size: 0.7rem;
            cursor: pointer;
            font-family: 'Exo 2', sans-serif;
        }
        
        .main-dashboard {
            position: relative;
            z-index: 10;
            display: none;
            flex-direction: column;
            height: 100%;
        }

        .dashboard-header {
            height: 65px;
            background: rgba(2, 8, 16, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 240, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1rem;
            position: relative;
            z-index: 50;
        }
        .dashboard-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
        }

        .header-left { display: flex; align-items: center; gap: 0.75rem; }
        .back-button {
            width: 38px;
            height: 38px;
            background: rgba(0, 240, 255, 0.08);
            border: 1px solid rgba(0, 240, 255, 0.15);
            border-radius: 0.6rem;
            display: none;
            align-items: center;
            justify-content: center;
            color: var(--accent);
            cursor: pointer;
            transition: all 0.3s;
        }
        .back-button.visible { display: flex; }
        .back-button:hover { background: rgba(0, 240, 255, 0.15); }

        .status-block { display: flex; flex-direction: column; gap: 0.15rem; }
        .status-row { display: flex; align-items: center; gap: 0.4rem; }
        .status-indicator-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--warning);
            animation: dotBlink 1.2s infinite;
        }
        .status-indicator-dot.online {
            background: var(--accent-3);
            box-shadow: 0 0 10px var(--accent-3);
            animation: none;
        }
        @keyframes dotBlink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

        .status-label {
            font-size: 0.55rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #5a7a8a;
        }

        .time-block {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .time-main {
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            color: var(--accent);
        }
        .time-date {
            font-size: 0.55rem;
            color: #5a7a8a;
            letter-spacing: 0.05em;
        }
        .time-zone {
            font-size: 0.5rem;
            color: var(--accent-3);
            font-weight: 600;
        }

        .header-right { display: flex; align-items: center; gap: 0.5rem; }
        .key-badge {
            padding: 0.3rem 0.65rem;
            background: rgba(0, 240, 255, 0.08);
            border: 1px solid rgba(0, 240, 255, 0.15);
            border-radius: 1rem;
            font-size: 0.6rem;
            font-weight: 600;
            color: var(--accent);
        }
        .avatar-button {
            width: 38px;
            height: 38px;
            background: linear-gradient(135deg, var(--accent), var(--accent-3));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.85rem;
            font-weight: 700;
            color: #020810;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.3);
        }
        .settings-button {
            width: 38px;
            height: 38px;
            background: rgba(0, 240, 255, 0.08);
            border: 1px solid rgba(0, 240, 255, 0.15);
            border-radius: 0.6rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent);
            cursor: pointer;
            transition: all 0.3s;
        }

        .settings-button:hover { background: rgba(0, 240, 255, 0.15); }

        .main-container {
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        .lobby-view {
            position: absolute;
            inset: 0;
            overflow-y: auto;
            padding: 1rem;
        }
        .lobby-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .welcome-block {
            margin-bottom: 1.5rem;
            text-align: center;
        }
        @media (min-width: 768px) { .welcome-block { text-align: left; } }

        .welcome-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 800;
            text-transform: uppercase;
        }
        @media (min-width: 768px) { .welcome-title { font-size: 1.9rem; } }
        .welcome-title span {
            background: linear-gradient(90deg, var(--accent), var(--accent-3));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .status-badges-row {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.75rem;
            justify-content: center;
        }
        @media (min-width: 768px) { .status-badges-row { justify-content: flex-start; } }
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.35rem 0.7rem;
            border-radius: 1rem;
            font-size: 0.6rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        .status-badge.success {
            background: rgba(0, 255, 136, 0.1);
            color: var(--accent-3);
            border: 1px solid rgba(0, 255, 136, 0.2);
        }
        .status-badge.info {
            background: rgba(0, 240, 255, 0.1);
            color: var(--accent);
            border: 1px solid rgba(0, 240, 255, 0.2);
        }
        .status-badge.warning {
            background: rgba(255, 193, 7, 0.1);
            color: var(--warning);
            border: 1px solid rgba(255, 193, 7, 0.2);
        }

        .search-block {
            position: relative;
            margin-bottom: 1.5rem;
        }
        .search-input-field {
            width: 100%;
            padding: 0.875rem 1rem 0.875rem 2.75rem;
            background: rgba(0, 0, 0, 0.35);
            border: 1px solid rgba(0, 240, 255, 0.12);
            border-radius: 0.75rem;
            color: white;
            font-size: 0.85rem;
            outline: none;
            transition: all 0.3s;
            font-family: 'Exo 2', sans-serif;
        }
        .search-input-field:focus { border-color: var(--accent); }
        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--accent);
            opacity: 0.6;
        }

        .portal-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            padding-bottom: 2rem;
        }
        @media (min-width: 480px) { .portal-grid { grid-template-columns: repeat(3, 1fr); } }
        @media (min-width: 768px) { .portal-grid { grid-template-columns: repeat(4, 1fr); } }
        @media (min-width: 1024px) { .portal-grid { grid-template-columns: repeat(5, 1fr); gap: 1rem; } }
        @media (min-width: 1280px) { .portal-grid { grid-template-columns: repeat(6, 1fr); } }

        .portal-card {
            position: relative;
            padding: 1rem;
            background: linear-gradient(145deg, rgba(10, 21, 37, 0.7), rgba(2, 8, 16, 0.85));
            border: 1px solid rgba(0, 240, 255, 0.1);
            border-radius: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }
        .portal-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 240, 255, 0.05), transparent);
            transition: left 0.5s;
        }
        .portal-card:hover {
            transform: translateY(-4px);
            border-color: rgba(0, 240, 255, 0.3);
            box-shadow: 0 10px 40px rgba(0, 240, 255, 0.15);
        }
        .portal-card:hover::before { left: 100%; }
        .portal-card:active { transform: scale(0.97); }

        .portal-icon-wrap {
            width: 48px;
            height: 48px;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            position: relative;
        }
        .portal-icon-wrap::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            box-shadow: inset 0 0 20px rgba(255,255,255,0.1);
        }
        .portal-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .portal-desc {
            font-size: 0.5rem;
            color: #5a7a8a;
            margin-top: 0.2rem;
            text-transform: uppercase;
        }

        .workspace-view {
            position: absolute;
            inset: 0;
            display: none;
            flex-direction: column;
        }
        .workspace-view.active { display: flex; }

        .chat-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(2, 8, 16, 0.5);
        }

        .chat-header {
            padding: 0.75rem 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid rgba(0, 240, 255, 0.08);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .chat-header-left { display: flex; align-items: center; gap: 0.6rem; }
        .chat-portal-icon {
            width: 36px;
            height: 36px;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }
        .chat-portal-info h4 {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.8rem;
            font-weight: 700;
        }
        .chat-portal-info p {
            font-size: 0.55rem;
            color: #5a7a8a;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .mode-indicator {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.35rem 0.7rem;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 1rem;
            font-size: 0.6rem;
            font-weight: 600;
        }
        .mode-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            animation: modePulse 2s ease-in-out infinite;
        }
        @keyframes modePulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .chat-message {
            max-width: 85%;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            animation: msgAppear 0.3s ease-out;
        }
        @keyframes msgAppear {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .chat-message.user {
            align-self: flex-end;
            background: linear-gradient(135deg, var(--accent), var(--accent-3));
            color: #020810;
            border-radius: 1rem 1rem 0.25rem 1rem;
        }
        .chat-message.ai {
            align-self: flex-start;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 240, 255, 0.1);
            border-radius: 1rem 1rem 1rem 0.25rem;
        }
        .msg-sender {
            font-size: 0.55rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.25rem;
            opacity: 0.8;
        }
        .msg-text { font-size: 0.8rem; line-height: 1.5; }
        .msg-attachment {
            font-size: 0.55rem;
            opacity: 0.7;
            margin-bottom: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        .msg-image {
            max-width: 200px;
            max-height: 150px;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            object-fit: cover;
        }

        .typing-dots {
            display: flex;
            gap: 0.25rem;
            padding: 0.5rem 0;
        }
        .typing-dots span {
            width: 6px;
            height: 6px;
            background: var(--accent);
            border-radius: 50%;
            animation: typingBounce 1.4s infinite ease-in-out both;
        }
        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typingBounce {
            0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; }
            40% { transform: scale(1); opacity: 1; }
        }

        .chat-input-area {
            padding: 0.75rem;
            background: linear-gradient(to top, rgba(2, 8, 16, 0.98), rgba(2, 8, 16, 0.9));
            border-top: 1px solid rgba(0, 240, 255, 0.08);
        }

        .attachment-preview-box {
            padding: 0.6rem;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 240, 255, 0.12);
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            display: none;
            align-items: center;
            gap: 0.75rem;
        }
        .attachment-preview-box.visible { display: flex; }
        .attachment-icon-box {
            width: 40px;
            height: 40px;
            background: rgba(0, 240, 255, 0.1);
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent);
        }
        .attachment-info { flex: 1; min-width: 0; }
        .attachment-filename {
            font-size: 0.75rem;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .attachment-filesize { font-size: 0.6rem; color: #5a7a8a; }
        .attachment-remove-btn {
            width: 30px;
            height: 30px;
            background: rgba(255, 51, 102, 0.1);
            border: none;
            border-radius: 0.5rem;
            color: var(--danger);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-input-row { display: flex; align-items: flex-end; gap: 0.5rem; }

        .attach-button {
            width: 40px;
            height: 40px;
            background: rgba(0, 240, 255, 0.08);
            border: 1px solid rgba(0, 240, 255, 0.15);
            border-radius: 0.5rem;
            color: var(--accent);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.3s;
        }
        .attach-button.active {
            background: rgba(0, 255, 136, 0.12);
            border-color: rgba(0, 255, 136, 0.2);
            color: var(--accent-3);
        }

        .attach-dropdown {
            position: absolute;
            bottom: 100%;
            left: 0;
            margin-bottom: 0.5rem;
            background: rgba(10, 21, 37, 0.98);
            border: 1px solid rgba(0, 240, 255, 0.15);
            border-radius: 0.75rem;
            padding: 0.4rem;
            display: none;
            flex-direction: column;
            gap: 0.15rem;
            min-width: 180px;
            box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.5);
            z-index: 100;
        }
        .attach-dropdown.visible { display: flex; animation: dropdownSlide 0.2s ease-out; }
        @keyframes dropdownSlide {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .attach-dropdown button {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            padding: 0.6rem 0.75rem;
            background: transparent;
            border: none;
            border-radius: 0.5rem;
            color: #e8f4f8;
            font-size: 0.75rem;
            cursor: pointer;
            text-align: left;
            font-family: 'Exo 2', sans-serif;
            transition: background 0.2s;
        }
        .attach-dropdown button:hover { background: rgba(0, 240, 255, 0.08); }

        .chat-textarea {
            flex: 1;
            padding: 0.75rem;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 240, 255, 0.12);
            border-radius: 0.75rem;
            color: white;
            font-size: 0.8rem;
            outline: none;
            resize: none;
            max-height: 100px;
            font-family: 'Exo 2', sans-serif;
            transition: border-color 0.3s;
          }

        .chat-textarea:focus { border-color: var(--accent); }

        .send-button {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent), var(--accent-3));
            border: none;
            border-radius: 0.5rem;
            color: #020810;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.3);
            transition: all 0.3s;
        }
        .send-button:hover { transform: scale(1.05); }
        .send-button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        .speed-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid rgba(0, 240, 255, 0.06);
        }
        .speed-label {
            font-size: 0.6rem;
            font-weight: 600;
            text-transform: uppercase;
            color: #5a7a8a;
        }
        .speed-option {
            padding: 0.25rem 0.6rem;
            border-radius: 1rem;
            font-size: 0.6rem;
            font-weight: 700;
            text-transform: uppercase;
            border: 1px solid;
            cursor: pointer;
            transition: all 0.3s;
            background: transparent;
        }
        .speed-option.fast { color: var(--accent-3); border-color: rgba(0, 255, 136, 0.25); }
        .speed-option.balanced { color: var(--warning); border-color: rgba(255, 193, 7, 0.25); }
        .speed-option.quality { color: var(--danger); border-color: rgba(255, 51, 102, 0.25); }
        .speed-option.selected { box-shadow: 0 0 15px currentColor; }

        .preview-panel {
            display: none;
            background: #000;
        }
        .preview-panel.visible { display: block; }
        .preview-iframe { width: 100%; height: 100%; border: none; }
        .preview-close-btn {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            width: 30px;
            height: 30px;
            background: rgba(0, 0, 0, 0.7);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            z-index: 10;
        }

        .sidebar-panel {
            position: fixed;
            inset-y: 0;
            right: 0;
            width: 320px;
            max-width: 85vw;
            background: linear-gradient(180deg, rgba(10, 21, 37, 0.98), rgba(2, 8, 16, 0.99));
            border-left: 1px solid rgba(0, 240, 255, 0.12);
            transform: translateX(100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 200;
            display: flex;
            flex-direction: column;
        }
        .sidebar-panel.open { transform: translateX(0); }

        .sidebar-header {
            padding: 1.25rem;
            border-bottom: 1px solid rgba(0, 240, 255, 0.08);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .sidebar-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            font-weight: 800;
            text-transform: uppercase;
        }
        .sidebar-title span { color: var(--accent); }
        .sidebar-close {
            width: 30px;
            height: 30px;
            background: rgba(0, 240, 255, 0.08);
            border: none;
            border-radius: 50%;
            color: var(--accent);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sidebar-body {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .sidebar-section {
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 240, 255, 0.08);
            border-radius: 0.75rem;
        }
        .sidebar-section-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .sidebar-section-title i { color: var(--accent); }

        .gemini-status-box { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem; }
        .gemini-icon-box {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent), var(--accent-3));
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .gemini-info-box h4 { font-family: 'Orbitron', sans-serif; font-size: 0.75rem; font-weight: 700; }
        .gemini-info-box p { font-size: 0.6rem; color: var(--accent-3); }

        .model-selector {
            width: 100%;
            padding: 0.5rem;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 240, 255, 0.12);
            border-radius: 0.5rem;
            color: white;
            font-size: 0.7rem;
            outline: none;
            font-family: 'Exo 2', sans-serif;
        }

        .key-pool-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.65rem;
        }
        .key-grid-display { display: grid; grid-template-columns: repeat(10, 1fr); gap: 0.2rem; }
        .key-indicator {
            aspect-ratio: 1;
            border-radius: 3px;
            transition: all 0.3s;
        }
        .key-indicator.active { background: var(--accent-3); box-shadow: 0 0 6px var(--accent-3); }
        .key-indicator.exhausted { background: var(--danger); opacity: 0.5; }
        .key-indicator.standby { background: rgba(0, 240, 255, 0.3); }

        .proxy-buttons { display: flex; flex-direction: column; gap: 0.4rem; }
        .proxy-action-btn {
            padding: 0.6rem;
            background: rgba(0, 240, 255, 0.08);
            border: 1px solid rgba(0, 240, 255, 0.15);
            border-radius: 0.5rem;
            color: var(--accent);
            font-size: 0.65rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-family: 'Exo 2', sans-serif;
            transition: all 0.3s;
        }
        .proxy-action-btn:hover { background: rgba(0, 240, 255, 0.12); }
        .proxy-action-btn.tor-active {
            background: rgba(255, 51, 102, 0.12);
            color: var(--accent-2);
        }

        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; }
        .stat-box {
            padding: 0.75rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 240, 255, 0.06);
            border-radius: 0.5rem;
            text-align: center;
        }
        .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--accent);
        }
        .stat-label {
            font-size: 0.55rem;
            color: #5a7a8a;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .sidebar-actions-list { display: flex; flex-direction: column; gap: 0.4rem; }
        .action-item-btn {
            padding: 0.7rem;
            background: rgba(0, 240, 255, 0.06);
            border: 1px solid rgba(0, 240, 255, 0.12);
            border-radius: 0.5rem;
            color: var(--accent);
            font-size: 0.7rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-family: 'Exo 2', sans-serif;
            transition: all 0.3s;
        }
        .action-item-btn:hover { background: rgba(0, 240, 255, 0.1); }
        .action-item-btn.danger {
            background: rgba(255, 51, 102, 0.08);
            border-color: rgba(255, 51, 102, 0.15);
            color: var(--danger);
        }

        .sidebar-footer {
            padding: 1rem;
            border-top: 1px solid rgba(0, 240, 255, 0.08);
        }
        .logout-btn {
            width: 100%;
            padding: 0.75rem;
            background: rgba(255, 51, 102, 0.1);
            border: 1px solid rgba(255, 51, 102, 0.2);
            border-radius: 0.5rem;
            color: var(--danger);
            font-family: 'Orbitron', sans-serif;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s;
        }
        .logout-btn:hover { background: rgba(255, 51, 102, 0.15); }

        .history-panel {
            position: fixed;
            inset: 0;
            z-index: 300;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .history-panel.open { display: flex; }
        .history-content {
            width: 100%;
            max-width: 480px;
            max-height: 80vh;
            background: linear-gradient(145deg, rgba(10, 21, 37, 0.98), rgba(2, 8, 16, 0.99));
            border: 1px solid rgba(0, 240, 255, 0.15);
            border-radius: 1rem;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .history-header {
            padding: 1rem;
            border-bottom: 1px solid rgba(0, 240, 255, 0.08);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .history-header h3 { font-family: 'Orbitron', sans-serif; font-weight: 700; font-size: 0.9rem; }
        .history-list-box { flex: 1; overflow-y: auto; padding: 1rem; }
        .history-entry {
            padding: 0.75rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 240, 255, 0.06);
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        .history-entry:hover { background: rgba(0, 240, 255, 0.08); }
        .history-meta-row { display: flex; justify-content: space-between; margin-bottom: 0.25rem; font-size: 0.6rem; }
        .history-portal-name { font-weight: 700; text-transform: uppercase; color: var(--accent); }
        .history-timestamp { color: #5a7a8a; }
        .history-prompt-text {
            font-size: 0.75rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .contact-panel {
            position: fixed;
            inset: 0;
            z-index: 350;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .contact-panel.open { display: flex; }
        .contact-content {
            width: 100%;
            max-width: 400px;
            background: linear-gradient(145deg, rgba(10, 21, 37, 0.98), rgba(2, 8, 16, 0.99));
            border: 1px solid rgba(0, 240, 255, 0.15);
            border-radius: 1rem;
            padding: 1.5rem;
        }
        .contact-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }
        .contact-header h3 { font-family: 'Orbitron', sans-serif; font-weight: 700; font-size: 0.95rem; }
        .contact-options { display: flex; flex-direction: column; gap: 0.75rem; }
        .contact-btn {
            padding: 1rem;
            background: rgba(0, 240, 255, 0.08);
            border: 1px solid rgba(0, 240, 255, 0.15);
            border-radius: 0.75rem;
            color: white;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
            transition: all 0.3s;
            font-family: 'Exo 2', sans-serif;
        }
        .contact-btn:hover { background: rgba(0, 240, 255, 0.12); transform: translateY(-2px); }
        .contact-btn i { font-size: 1.25rem; width: 24px; text-align: center; }
        .contact-btn.email i { color: var(--accent); }
        .contact-btn.whatsapp i { color: #25D366; }
        .contact-btn-info { flex: 1; }
        .contact-btn-label { font-weight: 700; text-transform: uppercase; font-size: 0.7rem; letter-spacing: 0.1em; }
        .contact-btn-desc { font-size: 0.65rem; color: #5a7a8a; margin-top: 0.2rem; }

        .toast-notification {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.75rem 1.5rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            z-index: 5000;
            animation: toastSlide 0.3s ease-out;
            font-family: 'Exo 2', sans-serif;
        }
        .toast-notification.success { background: rgba(0, 255, 136, 0.95); color: #020810; }
        .toast-notification.error { background: rgba(255, 51, 102, 0.95); color: white; }
        .toast-notification.warning { background: rgba(255, 193, 7, 0.95); color: #020810; }
        .toast-notification.info { background: rgba(0, 240, 255, 0.95); color: #020810; }
        @keyframes toastSlide {
            from { opacity: 0; transform: translateX(-50%) translateY(20px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        .modal-overlay {
            position: fixed;
            inset: 0;
            z-index: 400;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .modal-overlay.open { display: flex; }
        .modal-box {
            width: 100%;
            max-width: 360px;
            padding: 1.5rem;
            background: linear-gradient(145deg, rgba(10, 21, 37, 0.98), rgba(2, 8, 16, 0.99));
            border: 1px solid rgba(0, 240, 255, 0.15);
            border-radius: 1rem;
        }
        .modal-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .modal-input-field {
            width: 100%;
            padding: 0.75rem;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 240, 255, 0.12);
            border-radius: 0.5rem;
            color: white;
            font-size: 0.85rem;
            outline: none;
            margin-bottom: 1rem;
            font-family: 'Exo 2', sans-serif;
        }
        .modal-actions-row { display: flex; gap: 0.5rem; }
        .modal-action-btn {
            flex: 1;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
            font-family: 'Exo 2', sans-serif;
            transition: all 0.3s;
        }
        .modal-action-btn.cancel { background: rgba(90, 122, 138, 0.3); color: #8ab4c8; }
        .modal-action-btn.confirm { background: linear-gradient(135deg, var(--accent), var(--accent-3)); color: #020810; }

        .hidden { display: none !important; }
    </style>
</head>
<body>
    
    <div class="space-bg">
        <div class="stars-container" id="starsContainer"></div>
        <div class="nebula" style="width: 400px; height: 400px; background: rgba(0, 240, 255, 0.06); top: 10%; left: 5%;"></div>
        <div class="nebula" style="width: 350px; height: 350px; background: rgba(255, 51, 102, 0.04); bottom: 15%; right: 10%; animation-delay: 5s;"></div>
        <div class="nebula" style="width: 300px; height: 300px; background: rgba(0, 255, 136, 0.05); top: 50%; left: 60%; animation-delay: 10s;"></div>

        <div class="orbit-ring" style="width: 600px; height: 600px; top: 50%; left: 50%; transform: translate(-50%, -50%);">
            <div class="orbit-dot" style="top: 0; left: 50%; transform: translateX(-50%);"></div>
        </div>
        <div class="orbit-ring" style="width: 800px; height: 800px; top: 50%; left: 50%; transform: translate(-50%, -50%); animation-direction: reverse; animation-duration: 90s;">
            <div class="orbit-dot" style="bottom: 0; left: 50%; transform: translateX(-50%); background: var(--accent-3);"></div>
        </div>

        <div class="shooting-star" style="top: 20%; right: 15%; animation-delay: 0s;"></div>
        <div class="shooting-star" style="top: 40%; right: 30%; animation-delay: 3s;"></div>
        <div class="shooting-star" style="top: 60%; right: 20%; animation-delay: 7s;"></div>
        <div class="shooting-star" style="top: 35%; right: 45%; animation-delay: 11s;"></div>
    </div>

    <div id="loadingScreen" class="loading-screen">
        <div class="stars-container" id="loadingStarsContainer"></div>

        <div class="spaceship-wrapper">
            <div class="spaceship-4d">
                <div class="rocket-nose-cone"></div>
                <div class="rocket-main-body">
                    <div class="rocket-window"></div>
                    <div class="rocket-stripe"></div>
                </div>
                <div class="fin-left"></div>
                <div class="fin-right"></div>
                <div class="rocket-engine"></div>
                <div class="flame-container">
                    <div class="flame flame-outer"></div>
                    <div class="flame flame-middle"></div>
                    <div class="flame flame-inner"></div>
                </div>
                <div class="flame-glow-effect"></div>
                <div class="smoke-area" id="smokeArea"></div>
            </div>
        </div>

        <div class="loading-content">
            <div class="loading-brand">NEXUS</div>
            <div class="loading-tagline">Virza System Initializing</div>
            <div class="progress-container">
                <div class="progress-bar"></div>
            </div>
            <div class="status-container">
                <div class="status-text" id="statusMsg1">Loading Core Systems...</div>
                <div class="status-text" id="statusMsg2">Establishing Neural Link...</div>
                <div class="status-text" id="statusMsg3">Connecting to Gemini Network...</div>
                <div class="status-text" id="statusMsg4">Fetching Proxy Servers...</div>
                <div class="status-text" id="statusMsg5">Initializing Portal Gateway...</div>
                <div class="status-text" id="statusMsg6">All Systems Operational</div>
            </div>
        </div>
    </div>

    <div id="authScreen" class="auth-screen">
        <div class="station-panel">
            <div class="corner-frame tl"></div>
            <div class="corner-frame tr"></div>
            <div class="corner-frame bl"></div>
            <div class="corner-frame br"></div>

            <div class="station-logo-wrap">
                <div class="station-logo-ring"></div>
                <div class="station-logo-ring-2"></div>
                <div class="station-logo-inner"><i class="fa-solid fa-rocket"></i></div>
            </div>

            <h1 class="station-title">VIRZA <span>NEXUS</span></h1>
            <p class="station-subtitle">Space Station Access</p>

            <div class="input-field">
                <i class="fa-solid fa-envelope"></i>
                <input type="email" id="emailInput" placeholder="Email Address">
            </div>
            <div class="input-field">
                <i class="fa-solid fa-lock"></i>
                <input type="password" id="passwordInput" placeholder="Security Code">
            </div>

            <button class="btn-primary" id="authBtn">Initialize Connection</button>

            <div class="divider-line">
                <span></span>
                <p>or</p>
                <span></span>
            </div>

            <button class="btn-secondary" id="googleBtn">
                <svg width="16" height="16" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                Google
            </button>
            <button class="btn-secondary btn-anonymous" id="anonBtn">
                <i class="fa-solid fa-user-secret"></i>
                Guest login
            </button>

            <div class="auth-switch">
                <button id="authSwitchBtn">BELUM PUNYA AKUN? Daftar</button>
            </div>
        </div>
    </div>

    <div id="mainDashboard" class="main-dashboard">
        <header class="dashboard-header">
            <div class="header-left">
                <button class="back-button" id="backBtn">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <div class="status-block">
                    <div class="status-row">
                        <div class="status-indicator-dot" id="connectionDot"></div>
                        <span class="status-label" id="connectionLabel">CONNECTING</span>
                    </div>
                    <div class="time-block">
                        <div class="time-main" id="timeDisplay">00:00:00</div>
                        <div class="time-date" id="dateDisplay">Loading...</div>
                        <div class="time-zone" id="zoneDisplay">--</div>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <div class="key-badge" id="keyBadge">2 Keys</div>
                <button class="avatar-button" id="avatarBtn">V</button>
                <button class="settings-button" id="settingsBtn">
                    <i class="fa-solid fa-sliders"></i>
                </button>
            </div>
        </header>

        <main class="main-container">
            <div id="lobbyView" class="lobby-view no-scrollbar">
                <div class="lobby-content">
                    <div class="welcome-block">
                        <h2 class="welcome-title">Welcome, <span id="displayName">PLAYER NPC</span></h2>
                        <div class="status-badges-row">
                            <span class="status-badge success"><i class="fa-solid fa-circle-check"></i> Gemini Ready</span>
                            <span class="status-badge info"><i class="fa-solid fa-key"></i> <span id="activeKeyCount">20</span> Keys Active</span>
                            <span class="status-badge warning" id="proxyBadge"><i class="fa-solid fa-network-wired"></i> <span id="proxyCountDisplay">0</span> Proxies</span>
                        </div>
                    </div>

                    <div class="search-block">
                        <i class="fa-solid fa-search search-icon"></i>
                        <input type="text" class="search-input-field" id="portalSearch" placeholder="Search portals by name or function...">
                    </div>

                    <div class="portal-grid" id="portalGrid"></div>
                </div>
            </div>

            <div id="workspaceView" class="workspace-view">
                <div class="chat-panel">
                    <div class="chat-header">
                        <div class="chat-header-left">
                            <div class="chat-portal-icon" id="chatPortalIcon">
                                <i class="fa-solid fa-robot"></i>
                            </div>
                            <div class="chat-portal-info">
                                <h4 id="chatPortalName">Smart AI</h4>
                                <p id="chatPortalDesc">Neural Interface Active</p>
                            </div>
                        </div>
                        <div class="mode-indicator" id="modeIndicator">
                            <div class="mode-dot" style="background: var(--accent-3);"></div>
                            <span>Flash</span>
                        </div>
                    </div>

                    <div class="chat-messages no-scrollbar" id="chatMessages">
                        <div class="chat-message ai">
                            <div class="msg-sender">Nexus AI</div>
                            <div class="msg-text">Welcome NPC.</div>
                        </div>
                    </div>

                    <div class="chat-input-area">
                        <div class="attachment-preview-box" id="attachmentPreview">
                            <div class="attachment-icon-box" id="attachmentIcon">
                                <i class="fa-solid fa-file"></i>
                            </div>
                            <div class="attachment-info">
                                <div class="attachment-filename" id="attachmentName">file.jpg</div>
                                <div class="attachment-filesize" id="attachmentSize">1.2 MB</div>
                            </div>
                            <img id="attachmentImage" class="msg-image hidden" alt="">
                            <button class="attachment-remove-btn" id="removeAttachment">
                                <i class="fa-solid fa-xmark"></i>
                            </button>
                        </div>

                        <div class="chat-input-row">
                            <div class="attach-button" id="attachButton">
                                <i class="fa-solid fa-plus"></i>
                                <div class="attach-dropdown" id="attachDropdown">
                                    <button data-type="image">
                                        <i class="fa-solid fa-image" style="color: var(--accent-3);"></i>
                                        <span>Photo / Image</span>
                                    </button>
                                    <button data-type="video">
                                        <i class="fa-solid fa-video" style="color: var(--accent-2);"></i>
                                        <span>Video</span>
                                    </button>
                                    <button data-type="document">
                                        <i class="fa-solid fa-file-lines" style="color: var(--accent);"></i>
                                        <span>Document</span>
                                    </button>
                                    <button data-type="drive">
                                        <i class="fa-brands fa-google-drive" style="color: var(--warning);"></i>
                                        <span>Google Drive Link</span>
                                    </button>
                                </div>
                            </div>
                            <textarea class="chat-textarea" id="chatInput" placeholder="Enter your command..." rows="1"></textarea>
                            <button class="send-button" id="sendBtn">
                                <i class="fa-solid fa-paper-plane"></i>
                            </button>
                        </div>

                        <div class="speed-selector">
                            <span class="speed-label">Speed:</span>
                            <button class="speed-option fast selected" data-speed="fast">Fast</button>
                            <button class="speed-option balanced" data-speed="balanced">Balanced</button>
                            <button class="speed-option quality" data-speed="quality">Quality</button>
                        </div>
                    </div>
                </div>

                <div class="preview-panel" id="previewPanel">
                    <button class="preview-close-btn" id="previewClose">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                    <iframe id="previewFrame" class="preview-iframe" sandbox="allow-scripts allow-same-origin"></iframe>
                </div>
            </div>
        </main>
    </div>

    <aside class="sidebar-panel" id="sidebar">
        <div class="sidebar-header">
            <h3 class="sidebar-title">Control <span>Vault</span></h3>
            <button class="sidebar-close" id="sidebarClose">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>

        <div class="sidebar-body no-scrollbar">
            <div class="sidebar-section">
                <div class="sidebar-section-title"><i class="fa-solid fa-microchip"></i> NEXUS AI </div>
                <div class="gemini-status-box">
                    <div class="gemini-icon-box">
                        <i class="fa-solid fa-bolt" style="color: white;"></i>
                    </div>
                    <div class="gemini-info-box">
                        <h4>Gemini</h4>
                        <p id="geminiStatusText">Connected</p>
                    </div>
                </div>
                <select class="model-selector" id="modelSelector">
                    <option value="gemini-1.5-flash">Nexus 1.5 Flash</option>
                    <option value="gemini-1.5-flash-8b">Nexus 1.5 Flash-8B</option>
                    <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
                </select>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-section-title"><i class="fa-solid fa-key"></i> ACTIVE</div>
                <div class="key-pool-header">
                    <span>Active: <strong id="activeKeyNum">2</strong>/2</span>
                    <span id="resetTimer">--</span>
                </div>
                <div class="key-grid-display" id="keyGrid"></div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-section-title"><i class="fa-solid fa-network-wired"></i> Proxy Network</div>
                <div class="proxy-buttons">
                    <button class="proxy-action-btn" id="refreshProxyBtn">
                        <i class="fa-solid fa-rotate"></i>
                        Refresh Proxies (<span id="proxyNumSidebar">0</span>)
                    </button>
                    <button class="proxy-action-btn" id="torToggleBtn">
                        <i class="fa-solid fa-user-secret"></i>
                        Mode: OFF
                    </button>
                    <button class="proxy-action-btn" id="anonLoginBtn">
                        <i class="fa-solid fa-incognito"></i>
                        Anonymous Login
                    </button>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-section-title"><i class="fa-solid fa-chart-line"></i> Usage Statistics</div>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="messageCount">0</div>
                        <div class="stat-label">Messages</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="requestCount">0</div>
                        <div class="stat-label">Requests</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">15</div>
                        <div class="stat-label">RPM Limit</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">1.5K</div>
                        <div class="stat-label">Daily Quota</div>
                    </div>
                </div>
            </div>

            <div class="sidebar-actions-list">
                <button class="action-item-btn" id="historyBtn">
                    <i class="fa-solid fa-clock-rotate-left"></i>
                    Chat History
                </button>
                <button class="action-item-btn" id="clearChatBtn">
                    <i class="fa-solid fa-broom"></i>
                    Clear Chat
                </button>
                <button class="action-item-btn" id="contactDevBtn">
                    <i class="fa-solid fa-envelope"></i>
                    Contact Developer
                </button>
                <button class="action-item-btn danger" id="resetPoolBtn">
                    <i class="fa-solid fa-rotate-right"></i>
                    Reset Key Pool
                </button>
            </div>
        </div>

        <div class="sidebar-footer">
            <button class="logout-btn" id="logoutBtn">
                <i class="fa-solid fa-right-from-bracket"></i>
                Terminate Session
            </button>
        </div>
    </aside>

    <div class="history-panel" id="historyPanel">
        <div class="history-content">
            <div class="history-header">
                <h3>History</h3>
                <button class="sidebar-close" id="historyClose">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="history-list-box no-scrollbar" id="historyList">
                <p style="text-align: center; color: #5a7a8a; padding: 2rem;">No history yet. Start a conversation!</p>
            </div>
        </div>
    </div>

    <div class="contact-panel" id="contactPanel">
        <div class="contact-content">
            <div class="contact-header">
                <h3>Contact Developer</h3>
                <button class="sidebar-close" id="contactClose">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="contact-options">
                <a href="mailto:visi4ura@gmail.com?subject=Virza%20Nexus%20Support&body=Hello%20Developer%2C%0A%0AI%20need%20assistance%20with%20Virza%20Nexus.%0A%0A%5BPlease%20describe%20your%20issue%20or%20inquiry%20here%5D%0A%0ABest%20regards" class="contact-btn email">
                    <i class="fa-solid fa-envelope"></i>
                    <div class="contact-btn-info">
                        <div class="contact-btn-label">Email Support</div>
                        <div class="contact-btn-desc">visi4ura@gmail.com</div>
                    </div>
                </a>
                <a href="https://wa.me/6285715818953?text=Hello%20Developer%2C%0A%0AI%20am%20using%20Virza%20Nexus%20and%20need%20assistance.%0A%0A%5BPlease%20describe%20your%20issue%20here%5D" target="_blank" class="contact-btn whatsapp">
                    <i class="fa-brands fa-whatsapp"></i>
                    <div class="contact-btn-info">
                        <div class="contact-btn-label">WhatsApp</div>
                        <div class="contact-btn-desc">+62 857-1581-8953</div>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="driveModal">
        <div class="modal-box">
            <h4 class="modal-title"><i class="fa-brands fa-google-drive" style="color: var(--warning);"></i> Google Drive Link</h4>
            <input type="url" class="modal-input-field" id="driveLinkInput" placeholder="Paste your Google Drive link here...">
            <div class="modal-actions-row">
                <button class="modal-action-btn cancel" id="driveCancel">Cancel</button>
                <button class="modal-action-btn confirm" id="driveConfirm">Add Link</button>
            </div>
        </div>
    </div>

    <input type="file" id="fileInput" class="hidden" accept="image/*,video/*,.pdf,.doc,.docx,.txt">

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, serverTimestamp, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBK-MehTTzURY5jT5stH363Y5_WE4iy-XA",
            authDomain: "volca-tools.firebaseapp.com",
            projectId: "volca-tools",
            storageBucket: "volca-tools.firebasestorage.app",
            messagingSenderId: "262525907487",
            appId: "1:262525907487:web:4abc37fa3b583223569b2a"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        let isLoginMode = true;
        let currentUser = null;
        let currentAttachment = null;
        let currentSpeed = 'fast';
        let currentKeyIndex = 0;
        let exhaustedKeys = new Set();
        let freeProxies = [];
        let torMode = false;
        let messageCounter = 0;
        let requestCounter = 0;
        let activePortal = 'General';

        // API Keys Pool (Placeholder - Replace with real keys)
        const API_KEYS = [
           "AIzaSyDkUSuxeVnUHUzkANYePkrJMOTeC8Gx71E",
           "AIzaSyAAtWkmgIQBhJIbsuQAx_y4l_MB2OX1UGs"
        ];

        const portals = [
            { id: 'architect', name: 'Code Architect', icon: 'fa-code', color: '#818cf8', desc: 'Build & design software' },
            { id: 'imager', name: 'Image Forge', icon: 'fa-image', color: '#f472b6', desc: 'Create stunning visuals' },
            { id: 'smartai', name: 'Smart AI', icon: 'fa-comment', color: '#34d399', desc: 'General conversation' },
            { id: 'vision', name: 'Vision Pro', icon: 'fa-eye', color: '#fbbf24', desc: 'Analyze images & video' },
            { id: 'webweaver', name: 'Web Weaver', icon: 'fa-globe', color: '#60a5fa', desc: 'Build websites fast' },
            { id: 'cyberguard', name: 'Cyber Guard', icon: 'fa-shield-halved', color: '#f87171', desc: 'Security analysis' },
            { id: 'quantum', name: 'Quantum Math', icon: 'fa-calculator', color: '#a78bfa', desc: 'Complex calculations' },
            { id: 'seomaster', name: 'SEO Master', icon: 'fa-magnifying-glass-chart', color: '#2dd4bf', desc: 'Optimize content' },
            { id: 'dataminer', name: 'Data Miner', icon: 'fa-database', color: '#94a3b8', desc: 'Extract & analyze data' },
            { id: 'socialads', name: 'Social Ads', icon: 'fa-hashtag', color: '#fb7185', desc: 'Marketing campaigns' },
            { id: 'motion', name: 'Motion AI', icon: 'fa-film', color: '#fb923c', desc: 'Video & animation' },
            { id: 'sonic', name: 'Sonic Wave', icon: 'fa-music', color: '#4ade80', desc: 'Audio processing' },
            { id: 'brand', name: 'Brand AI', icon: 'fa-pen-nib', color: '#e879f9', desc: 'Branding & design' },
            { id: 'polyglot', name: 'Polyglot', icon: 'fa-language', color: '#818cf8', desc: 'Translation hub' },
            { id: 'debug', name: 'Debug Sys', icon: 'fa-bug', color: '#ef4444', desc: 'Find & fix bugs' },
            { id: 'cloud', name: 'Cloud Drive', icon: 'fa-cloud', color: '#38bdf8', desc: 'Cloud integration' },
            { id: 'vault', name: 'Vault Pro', icon: 'fa-lock', color: '#fbbf24', desc: 'Secure storage' },
            { id: 'writer', name: 'Ghost Writer', icon: 'fa-book', color: '#c084fc', desc: 'Content creation' },
            { id: 'gamedev', name: 'Game Dev', icon: 'fa-gamepad', color: '#f472b6', desc: 'Game development' },
            { id: 'lawlogic', name: 'Law Logic', icon: 'fa-gavel', color: '#fca5a5', desc: 'Legal assistance' },
            { id: 'health', name: 'Medi AI', icon: 'fa-heart-pulse', color: '#ef4444', desc: 'Health insights' },
            { id: 'finance', name: 'Fin AI', icon: 'fa-chart-pie', color: '#22c55e', desc: 'Financial analysis' },
            { id: 'educate', name: 'Edu AI', icon: 'fa-graduation-cap', color: '#3b82f6', desc: 'Learning assistant' },
            { id: 'travel', name: 'Travel AI', icon: 'fa-plane', color: '#06b6d4', desc: 'Trip planning' },
            { id: 'recipe', name: 'Chef AI', icon: 'fa-utensils', color: '#f97316', desc: 'Recipes & cooking' },
            { id: 'fitness', name: 'Fit AI', icon: 'fa-dumbbell', color: '#84cc16', desc: 'Workout plans' },
            { id: 'news', name: 'News AI', icon: 'fa-newspaper', color: '#6366f1', desc: 'News aggregator' }
        ];

        const loadingScreen = document.getElementById('loadingScreen');
        const authScreen = document.getElementById('authScreen');
        const mainDashboard = document.getElementById('mainDashboard');
        const emailInput = document.getElementById('emailInput');
        const passwordInput = document.getElementById('passwordInput');
        const authBtn = document.getElementById('authBtn');
        const googleBtn = document.getElementById('googleBtn');
        const anonBtn = document.getElementById('anonBtn');
        const authSwitchBtn = document.getElementById('authSwitchBtn');
        const backBtn = document.getElementById('backBtn');
        const connectionDot = document.getElementById('connectionDot');
        const connectionLabel = document.getElementById('connectionLabel');
        const timeDisplay = document.getElementById('timeDisplay');
        const dateDisplay = document.getElementById('dateDisplay');
        const zoneDisplay = document.getElementById('zoneDisplay');
        const displayName = document.getElementById('displayName');
        const avatarBtn = document.getElementById('avatarBtn');
        const settingsBtn = document.getElementById('settingsBtn');
        const sidebar = document.getElementById('sidebar');
        const sidebarClose = document.getElementById('sidebarClose');
        const portalSearch = document.getElementById('portalSearch');
        const portalGrid = document.getElementById('portalGrid');
        const lobbyView = document.getElementById('lobbyView');
        const workspaceView = document.getElementById('workspaceView');
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        const attachButton = document.getElementById('attachButton');
        const attachDropdown = document.getElementById('attachDropdown');
        const attachmentPreview = document.getElementById('attachmentPreview');
        const fileInput = document.getElementById('fileInput');
        const historyPanel = document.getElementById('historyPanel');
        const historyList = document.getElementById('historyList');
        const contactPanel = document.getElementById('contactPanel');
        const driveModal = document.getElementById('driveModal');
        const previewPanel = document.getElementById('previewPanel');
        const previewFrame = document.getElementById('previewFrame');

        function createStars(container, count) {
            const sizes = ['tiny', 'small', 'medium', 'large'];
            for (let i = 0; i < count; i++) {
                const star = document.createElement('div');
                const size = sizes[Math.floor(Math.random() * sizes.length)];
                star.className = `star star-${size}`;
                star.style.cssText = `
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                    width: ${Math.random() * 2 + 1}px;
                    height: ${Math.random() * 2 + 1}px;
                    animation-delay: ${Math.random() * 3}s;
                `;
                container.appendChild(star);
            }
        }

        function createSmokeParticles() {
            const smokeArea = document.getElementById('smokeArea');
            if (!smokeArea) return;

            setInterval(() => {
                const particle = document.createElement('div');
                particle.className = 'smoke-p';
                particle.style.cssText = `
                    width: ${Math.random() * 15 + 8}px;
                    height: ${Math.random() * 15 + 8}px;
                    left: ${Math.random() * 40 - 20}px;
                `;
                smokeArea.appendChild(particle);
                setTimeout(() => particle.remove(), 2500);
            }, 150);
        }

        function runLoadingSequence() {
            const statuses = ['statusMsg1', 'statusMsg2', 'statusMsg3', 'statusMsg4', 'statusMsg5', 'statusMsg6'];
            let index = 0;

            const showNext = () => {
                if (index > 0) {
                    document.getElementById(statuses[index - 1]).classList.remove('active');
                }
                if (index < statuses.length) {
                    document.getElementById(statuses[index]).classList.add('active');
                    index++;
                    setTimeout(showNext, 800);
                }
            };

            setTimeout(showNext, 2000);

            setTimeout(() => {
                loadingScreen.classList.add('hidden');
                authScreen.style.display = 'flex';
            }, 5500);
        }

        function showToast(message, type = 'success') {
            const existing = document.querySelector('.toast-notification');
            if (existing) existing.remove();

            const toast = document.createElement('div');
            toast.className = `toast-notification ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
        window.showToast = showToast;

        function updateKeyGrid() {
            const activeCount = API_KEYS.length - exhaustedKeys.size;
            document.getElementById('activeKeyNum').textContent = activeCount;
            document.getElementById('activeKeyCount').textContent = activeCount;
            document.getElementById('keyBadge').textContent = `${activeCount} Keys`;

            const grid = document.getElementById('keyGrid');
            grid.innerHTML = API_KEYS.map((_, i) => {
                let className = 'key-indicator standby';
                if (i === currentKeyIndex && !exhaustedKeys.has(i)) {
                    className = 'key-indicator active';
                } else if (exhaustedKeys.has(i)) {
                    className = 'key-indicator exhausted';
                }
                return `<div class="${className}"></div>`;
            }).join('');
        }

        function getApiKey() {
            let attempts = 0;
            while (attempts < API_KEYS.length) {
                if (!exhaustedKeys.has(currentKeyIndex)) {
                    updateKeyGrid();
                    return { key: API_KEYS[currentKeyIndex], index: currentKeyIndex };
                }
                currentKeyIndex = (currentKeyIndex + 1) % API_KEYS.length;
                attempts++;
            }

            showToast('All keys exhausted. Resetting in 60s...', 'warning');
            let seconds = 60;
            const timerDisplay = document.getElementById('resetTimer');
            const interval = setInterval(() => {
                seconds--;
                timerDisplay.textContent = `${seconds}s`;
                if (seconds <= 0) {
                    clearInterval(interval);
                    exhaustedKeys.clear();
                    currentKeyIndex = 0;
                    updateKeyGrid();
                    showToast('Key pool reset!', 'success');
                    timerDisplay.textContent = '--';
                }
            }, 1000);
            return null;
        }

        function markKeyExhausted(index) {
            exhaustedKeys.add(index);
            currentKeyIndex = (index + 1) % API_KEYS.length;
            updateKeyGrid();
            showToast(`Key ${index + 1} rate limited`, 'warning');
        }

        function updateDateTime() {
            try {
                const now = new Date();
                const options = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
                const dateOptions = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
                const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                let zoneLabel = timezone.split('/').pop().replace(/_/g, ' ');
                const offset = now.getTimezoneOffset();
                let indonesianZone = '';
                if (offset === -420) indonesianZone = 'WIB';
                else if (offset === -480) indonesianZone = 'WITA';
                else if (offset === -540) indonesianZone = 'WIT';

                timeDisplay.textContent = now.toLocaleTimeString('id-ID', options);
                dateDisplay.textContent = now.toLocaleDateString('id-ID', dateOptions);
                zoneDisplay.textContent = indonesianZone || zoneLabel;
            } catch (e) {
                timeDisplay.textContent = new Date().toLocaleTimeString('id-ID', { hour12: false });
            }
        }

        // Fetch Free Proxies
        async function fetchProxies() {
            showToast('Fetching proxies...', 'info');
            const sources = [
                'https://api.proxyscrape.com/v2/?request=getproxies&protocol=http&timeout=10000&country=all&ssl=all&anonymity=all',
                'https://raw.githubusercontent.com/TheSpeedX/PROXY-List/master/http.txt'
            ];

        const allProxies = new Set();

            for (const source of sources) {
                try {
                    const res = await fetch(source);
                    const text = await res.text();
                    text.split('\n')
                        .filter(line => line.includes(':'))
                        .map(line => line.trim())
                        .filter(proxy => proxy.match(/\d+\.\d+\.\d+\.\d+:\d+/))
                        .forEach(p => allProxies.add(p));
                } catch (e) { /* Continue */ }
            }

            freeProxies = Array.from(allProxies).sort(() => Math.random() - 0.5).slice(0, 50);
            document.getElementById('proxyCountDisplay').textContent = freeProxies.length;
            document.getElementById('proxyNumSidebar').textContent = freeProxies.length;
            showToast(`${freeProxies.length} proxies loaded`, 'success');
        }

        function renderPortals(filteredPortals = portals) {
            portalGrid.innerHTML = filteredPortals.map(portal => `
                <div class="portal-card" data-id="${portal.id}" data-name="${portal.name}" data-icon="${portal.icon}" data-color="${portal.color}">
                    <div class="portal-icon-wrap" style="background: ${portal.color}15; color: ${portal.color}; border: 1px solid ${portal.color}30;">
                        <i class="fa-solid ${portal.icon}"></i>
                    </div>
                    <div class="portal-name">${portal.name}</div>
                    <div class="portal-desc">${portal.desc}</div>
                </div>
            `).join('');
        }

        function filterPortals() {
            const query = portalSearch.value.toLowerCase();
            const filtered = portals.filter(p =>
                p.name.toLowerCase().includes(query) ||
                p.desc.toLowerCase().includes(query) ||
                p.id.includes(query)
            );
            renderPortals(filtered);
        }

        function enterPortal(portalId, portalName, portalIcon, portalColor) {
            activePortal = portalName;
            lobbyView.classList.add('hidden');
            workspaceView.classList.add('active');
            backBtn.classList.add('visible');

            document.getElementById('chatPortalName').textContent = portalName;
            document.getElementById('chatPortalDesc').textContent = `${portalName} Interface Active`;
            document.getElementById('chatPortalIcon').innerHTML = `<i class="fa-solid ${portalIcon}"></i>`;
            document.getElementById('chatPortalIcon').style.background = `${portalColor}15`;
            document.getElementById('chatPortalIcon').style.color = portalColor;

            chatMessages.innerHTML = `
                <div class="chat-message ai">
                    <div class="msg-sender">${portalName}</div>
                    <div class="msg-text">Portal activated. I'm ready to assist you with ${portalName.toLowerCase()}. How can I help?</div>
                </div>
            `;

            setTimeout(() => chatInput.focus(), 100);
        }

        function exitPortal() {
            lobbyView.classList.remove('hidden');
            workspaceView.classList.remove('active');
            backBtn.classList.remove('visible');
            previewPanel.classList.remove('visible');
        }

        function toggleSidebar() {
            sidebar.classList.toggle('open');
        }

        function toggleAttachDropdown() {
            attachDropdown.classList.toggle('visible');
        }

        function handleFileAttachment(type) {
            attachDropdown.classList.remove('visible');

            if (type === 'drive') {
                driveModal.classList.add('open');
                return;
            }

            const acceptTypes = {
                image: 'image/*',
                video: 'video/*',
                document: '.pdf,.doc,.docx,.txt'
            };

            fileInput.accept = acceptTypes[type] || '*';
            fileInput.click();
        }

        function showAttachmentPreview() {
            if (!currentAttachment) {
                attachmentPreview.classList.remove('visible');
                attachButton.classList.remove('active');
                return;
            }

            attachmentPreview.classList.add('visible');
            attachButton.classList.add('active');
            document.getElementById('attachmentName').textContent = currentAttachment.name;
            document.getElementById('attachmentSize').textContent = currentAttachment.size;

            const iconBox = document.getElementById('attachmentIcon');
            const imgPreview = document.getElementById('attachmentImage');

            if (currentAttachment.type === 'image' && currentAttachment.file) {
                iconBox.innerHTML = '<i class="fa-solid fa-image"></i>';
                const reader = new FileReader();
                reader.onload = (e) => {
                    imgPreview.src = e.target.result;
                    imgPreview.classList.remove('hidden');
                };
                reader.readAsDataURL(currentAttachment.file);
            } else if (currentAttachment.type === 'video') {
                iconBox.innerHTML = '<i class="fa-solid fa-video"></i>';
                imgPreview.classList.add('hidden');
            } else if (currentAttachment.type === 'drive') {
                iconBox.innerHTML = '<i class="fa-brands fa-google-drive"></i>';
                imgPreview.classList.add('hidden');
            } else {
                iconBox.innerHTML = '<i class="fa-solid fa-file-lines"></i>';
                imgPreview.classList.add('hidden');
            }
        }

        function removeAttachment() {
            currentAttachment = null;
            showAttachmentPreview();
        }

        function autoResizeTextarea(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 100) + 'px';
        }

        function updateModeIndicator() {
            const model = document.getElementById('modelSelector').value;
            const modelShort = model.includes('pro') ? 'Pro' : model.includes('8b') ? '8B' : 'Flash';

            const speedColors = {
                fast: 'var(--accent-3)',
                balanced: 'var(--warning)',
                quality: 'var(--danger)'
            };

            document.getElementById('modeIndicator').innerHTML = `
                <div class="mode-dot" style="background: ${speedColors[currentSpeed]};"></div>
                <span>${modelShort}</span>
            `;
        }

        async function sendMessage() {
            const prompt = chatInput.value.trim();
            if (!prompt && !currentAttachment) return;

            const keyInfo = getApiKey();
            if (!keyInfo) return;

            const { key, index } = keyInfo;
            const model = document.getElementById('modelSelector').value;

            const parts = [];

            if (currentAttachment && currentAttachment.type === 'image' && currentAttachment.file) {
                try {
                    const base64Data = await new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = () => {
                            const base64 = reader.result.split(',')[1];
                            resolve(base64);
                        };
                        reader.onerror = reject;
                        reader.readAsDataURL(currentAttachment.file);
                    });

                    parts.push({
                        inline_data: {
                            mime_type: currentAttachment.file.type,
                            data: base64Data
                        }
                    });
                } catch (e) {
                    showToast('Gagal membaca file gambar', 'error');
                    return;
                }
            }

            if (prompt) {
                parts.push({ text: prompt });
            } else if (currentAttachment && currentAttachment.type === 'image') {
                parts.push({ text: "Tolong analisis gambar ini.","ini apa?" });
            }

            let userMsgHtml = '<div class="chat-message user">';
            if (currentAttachment?.type === 'image' && currentAttachment.file) {
                const imgPreviewUrl = URL.createObjectURL(currentAttachment.file);
                userMsgHtml += `<img src="${imgPreviewUrl}" class="msg-image" style="max-width:150px; border-radius:8px; margin-bottom:5px;">`;
            }
            if (currentAttachment) {
                userMsgHtml += `<div class="msg-attachment"><i class="fa-solid fa-paperclip"></i>${currentAttachment.name}</div>`;
            }
            userMsgHtml += `<div class="msg-text">${prompt || "(Mengirim gambar...)"}</div></div>`;
            chatMessages.innerHTML += userMsgHtml;

            chatInput.value = '';
            chatInput.style.height = 'auto';
            chatMessages.scrollTop = chatMessages.scrollHeight;

            if (currentUser) {
                try {
                    await addDoc(collection(db, 'artifacts', 'virza-nexus', 'users', currentUser.uid, 'history'), {
                        prompt: prompt || "[Image Attachment]",
                        portal: activePortal,
                        timestamp: serverTimestamp()
                    });
                } catch (e) {}
            }

            const typingId = 'typing-' + Date.now();
            chatMessages.innerHTML += `
                <div id="${typingId}" class="chat-message ai">
                    <div class="typing-dots">
                        <span></span><span></span><span></span>
                    </div>
                </div>
            `;
            chatMessages.scrollTop = chatMessages.scrollHeight;

            try {
                sendBtn.disabled = true;
                const genConfig = SPEED_CONFIG[currentSpeed] || SPEED_CONFIG.balanced;

                const WORKER_URL = "https://nexus.visiaura.workers.dev"; 
                const originalUrl = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${key}`;
                const proxiedUrl = `${WORKER_URL}?url=${encodeURIComponent(originalUrl)}`;

                const response = await fetch(proxiedUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: parts }],
                        generationConfig: genConfig
                    })
                });

                document.getElementById(typingId)?.remove();
                const data = await response.json();

                if (data.error) {
                    if (data.error.message?.includes('quota') || data.error.status === 'RESOURCE_EXHAUSTED') {
                        markKeyExhausted(index);
                        showToast('Key limit, pindah key lain...', 'warning');
                        sendBtn.disabled = false;
                        setTimeout(() => sendMessage(), 500);
                        return;
                    }
                    throw new Error(data.error.message || 'API Error');
                }

                const responseText = data.candidates?.[0]?.content?.parts?.[0]?.text || 'Tidak ada respons.';
                chatMessages.innerHTML += `
                    <div class="chat-message ai">
                        <div class="msg-sender">Nexus AI</div>
                        <div class="msg-text">${responseText.replace(/\n/g, '<br>')}</div>
                    </div>
                `;

                messageCounter++;
                requestCounter++;
                document.getElementById('messageCount').textContent = messageCounter;
                document.getElementById('requestCount').textContent = requestCounter;

                const codeMatch = responseText.match(/```html?\s*([\s\S]*?)```/);
                if (codeMatch) {
                    previewPanel.classList.add('visible');
                    previewFrame.src = URL.createObjectURL(new Blob([codeMatch[1].trim()], { type: 'text/html' }));
                }

                sendBtn.disabled = false;
            } catch (error) {
                document.getElementById(typingId)?.remove();
                chatMessages.innerHTML += `
                    <div class="chat-message ai">
                        <div class="msg-text" style="color: var(--danger);">Error: ${error.message}</div>
                    </div>
                `;
                sendBtn.disabled = false;
            }

            removeAttachment();
            chatMessages.scrollTop = chatMessages.scrollHeight;
                            }

            let fullPrompt = prompt;
            if (currentAttachment) {
                if (currentAttachment.type === 'drive') {
                    fullPrompt = `[Drive Link: ${currentAttachment.url}]\n\n${prompt}`;
                } else {
                    fullPrompt = `[File: ${currentAttachment.name}]\n\n${prompt}`;
                }
            }

            let userMsgHtml = '<div class="chat-message user">';
            if (currentAttachment?.type === 'image' && currentAttachment.file) {
                const imageData = await new Promise(resolve => {
                    const reader = new FileReader();
                    reader.onload = e => resolve(e.target.result);
                    reader.readAsDataURL(currentAttachment.file);
                });
                userMsgHtml += `<img src="${imageData}" class="msg-image">`;
            }
            if (currentAttachment) {
                userMsgHtml += `<div class="msg-attachment"><i class="fa-solid fa-paperclip"></i>${currentAttachment.name}</div>`;
            }
            userMsgHtml += `<div class="msg-text">${prompt}</div></div>`;
            chatMessages.innerHTML += userMsgHtml;

            chatInput.value = '';
            chatInput.style.height = 'auto';
            removeAttachment();
            chatMessages.scrollTop = chatMessages.scrollHeight;

            if (currentUser) {
                try {
                    await addDoc(collection(db, 'artifacts', 'virza-nexus', 'users', currentUser.uid, 'history'), {
                        prompt: prompt,
                        portal: activePortal,
                        timestamp: serverTimestamp()
                    });
                } catch (e) { /* Silent fail */ }
             }

            const typingId = 'typing-' + Date.now();
            chatMessages.innerHTML += `
                <div id="${typingId}" class="chat-message ai">
                    <div class="typing-dots">
                        <span></span><span></span><span></span>
                    </div>
                </div>
            `;
            chatMessages.scrollTop = chatMessages.scrollHeight;

            try {
                sendBtn.disabled = true;
                const model = document.getElementById('modelSelector').value;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${key}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: fullPrompt }] }],
                        generationConfig: {
                            temperature: 0.7,
                            maxOutputTokens: 2048
                        }
                    })
                });

                document.getElementById(typingId)?.remove();
                const data = await response.json();

                if (data.error) {
                    if (data.error.message?.includes('quota') || data.error.status === 'RESOURCE_EXHAUSTED') {
                        markKeyExhausted(index);
                        showToast('Key rate limited, switching...', 'warning');
                        sendBtn.disabled = false;
                        setTimeout(() => sendMessage(), 300);
                        return;
                    }
                    throw new Error(data.error.message || 'API Error');
                }

                const responseText = data.candidates?.[0]?.content?.parts?.[0]?.text || 'No response generated.';
                chatMessages.innerHTML += `
                    <div class="chat-message ai">
                        <div class="msg-sender">Nexus AI</div>
                        <div class="msg-text">${responseText.replace(/\n/g, '<br>')}</div>
                    </div>
                `;

                messageCounter++;
                requestCounter++;
                document.getElementById('messageCount').textContent = messageCounter;
                document.getElementById('requestCount').textContent = requestCounter;

                const codeMatch = responseText.match(/```html?\s*([\s\S]*?)```/);
                if (codeMatch) {
                    previewPanel.classList.add('visible');
                    previewFrame.src = URL.createObjectURL(new Blob([codeMatch[1].trim()], { type: 'text/html' }));
                }

                sendBtn.disabled = false;
            } catch (error) {
                document.getElementById(typingId)?.remove();
                chatMessages.innerHTML += `
                    <div class="chat-message ai">
                        <div class="msg-text" style="color: var(--danger);">Error: ${error.message}</div>
                    </div>
                `;
                sendBtn.disabled = false;
            }

            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        async function loadHistory() {
            if (!currentUser) return;

            try {
                const snapshot = await getDocs(query(
                    collection(db, 'artifacts', 'virza-nexus', 'users', currentUser.uid, 'history'),
                    orderBy('timestamp', 'desc'),
                    limit(50)
                ));

                if (snapshot.empty) return;

                historyList.innerHTML = '';
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const time = data.timestamp?.toDate?.() || new Date();
                    const entry = document.createElement('div');
                    entry.className = 'history-entry';
                    entry.innerHTML = `
                        <div class="history-meta-row">
                            <span class="history-portal-name">${data.portal || 'General'}</span>
                            <span class="history-timestamp">${time.toLocaleString('id-ID', { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' })}</span>
                        </div>
                        <div class="history-prompt-text">"${data.prompt}"</div>
                    `;
                    entry.onclick = () => {
                        chatInput.value = data.prompt;
                        historyPanel.classList.remove('open');
                    };
                    historyList.appendChild(entry);
                });
            } catch (e) { /* Silent fail */ }
        }

        function clearChat() {
            chatMessages.innerHTML = `
                <div class="chat-message ai">
                    <div class="msg-sender">Nexus AI</div>
                    <div class="msg-text">Chat cleared. Ready for new commands!</div>
                </div>
            `;
            showToast('Chat cleared', 'success');
        }

        function resetKeyPool() {
            exhaustedKeys.clear();
            currentKeyIndex = 0;
            updateKeyGrid();
            showToast('Key pool reset', 'success');
        }

        function toggleTorMode() {
            torMode = !torMode;
            const btn = document.getElementById('torToggleBtn');
            btn.innerHTML = `<i class="fa-solid fa-user-secret"></i> Tor Mode: ${torMode ? 'ON' : 'OFF'}`;
            btn.classList.toggle('tor-active', torMode);
            showToast(`Tor mode ${torMode ? 'activated' : 'deactivated'}`, 'info');
        }

        async function handleAnonymousLogin() {
            try {
                await signInAnonymously(auth);
            } catch (error) {
                currentUser = {
                    uid: 'guest_' + Math.random().toString(36).substring(2, 10),
                    isAnonymous: true
                };
                authScreen.style.display = 'none';
                mainDashboard.style.display = 'flex';
                showToast('Guest mode activated', 'info');
            }
        }

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                const name = user.displayName || user.email?.split('@')[0] || 'Commander';
                displayName.textContent = name.toUpperCase();
                avatarBtn.textContent = name[0].toUpperCase();
                authScreen.style.display = 'none';
                mainDashboard.style.display = 'flex';

                setTimeout(() => {
                    connectionDot.classList.add('online');
                    connectionLabel.textContent = 'ONLINE';
                }, 1000);

                loadHistory();
            }
        });

        authBtn.addEventListener('click', () => {
            const email = emailInput.value.trim();
            const password = passwordInput.value;

            if (!email || !password) {
                showToast('Please fill all fields', 'error');
                return;
            }

            if (isLoginMode) {
                signInWithEmailAndPassword(auth, email, password).catch(e => showToast(e.message, 'error'));
            } else {
                createUserWithEmailAndPassword(auth, email, password).catch(e => showToast(e.message, 'error'));
            }
        });

        googleBtn.addEventListener('click', () => signInWithPopup(auth, googleProvider).catch(e => showToast(e.message, 'error')));
        anonBtn.addEventListener('click', handleAnonymousLogin);

        authSwitchBtn.addEventListener('click', () => {
            isLoginMode = !isLoginMode;
            authSwitchBtn.textContent = isLoginMode ? 'Need an account? Register' : 'Have an account? Login';
            authBtn.textContent = isLoginMode ? 'Initialize Connection' : 'Create Account';
        });

        backBtn.addEventListener('click', exitPortal);
        settingsBtn.addEventListener('click', toggleSidebar);
        avatarBtn.addEventListener('click', toggleSidebar);
        sidebarClose.addEventListener('click', toggleSidebar);

        portalSearch.addEventListener('input', filterPortals);

        portalGrid.addEventListener('click', (e) => {
            const card = e.target.closest('.portal-card');
            if (card) {
                enterPortal(card.dataset.id, card.dataset.name, card.dataset.icon, card.dataset.color);
            }
        });

        attachButton.addEventListener('click', toggleAttachDropdown);

        attachDropdown.addEventListener('click', (e) => {
            const btn = e.target.closest('button');
            if (btn) {
                handleFileAttachment(btn.dataset.type);
            }
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            currentAttachment = {
                type: file.type.startsWith('image') ? 'image' : file.type.startsWith('video') ? 'video' : 'document',
                file: file,
                name: file.name,
                size: (file.size / 1024).toFixed(1) + ' KB'
            };
            showAttachmentPreview();
            showToast(`File attached: ${file.name}`, 'success');
        });

        document.getElementById('removeAttachment').addEventListener('click', removeAttachment);

        document.getElementById('driveConfirm').addEventListener('click', () => {
            const link = document.getElementById('driveLinkInput').value.trim();
            if (!link) return;

            currentAttachment = { type: 'drive', name: 'Drive Link', url: link, size: 'Link' };
            showAttachmentPreview();
            driveModal.classList.remove('open');
            document.getElementById('driveLinkInput').value = '';
            showToast('Drive link added', 'success');
        });

        document.getElementById('driveCancel').addEventListener('click', () => {
            driveModal.classList.remove('open');
            document.getElementById('driveLinkInput').value = '';
        });

        chatInput.addEventListener('input', () => autoResizeTextarea(chatInput));
        chatInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        sendBtn.addEventListener('click', sendMessage);

        document.querySelectorAll('.speed-option').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.speed-option').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                currentSpeed = btn.dataset.speed;
                updateModeIndicator();
            });
        });

        document.getElementById('modelSelector').addEventListener('change', updateModeIndicator);

        document.getElementById('refreshProxyBtn').addEventListener('click', fetchProxies);
        document.getElementById('torToggleBtn').addEventListener('click', toggleTorMode);
        document.getElementById('anonLoginBtn').addEventListener('click', handleAnonymousLogin);

        document.getElementById('historyBtn').addEventListener('click', () => historyPanel.classList.add('open'));
        document.getElementById('historyClose').addEventListener('click', () => historyPanel.classList.remove('open'));

        document.getElementById('clearChatBtn').addEventListener('click', clearChat);
        document.getElementById('resetPoolBtn').addEventListener('click', resetKeyPool);

        document.getElementById('contactDevBtn').addEventListener('click', () => contactPanel.classList.add('open'));
        document.getElementById('contactClose').addEventListener('click', () => contactPanel.classList.remove('open'));

        document.getElementById('logoutBtn').addEventListener('click', () => signOut(auth));

        document.getElementById('previewClose').addEventListener('click', () => previewPanel.classList.remove('visible'));

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.attach-button') && !e.target.closest('.attach-dropdown')) {
                attachDropdown.classList.remove('visible');
            }
        });

        createStars(document.getElementById('starsContainer'), 150);
        createStars(document.getElementById('loadingStarsContainer'), 80);
        createSmokeParticles();
        runLoadingSequence();
        renderPortals();
        updateKeyGrid();

        setInterval(updateDateTime, 1000);
        updateDateTime();

        setTimeout(fetchProxies, 6000);
        setInterval(fetchProxies, 1800000); // Refresh selama 30 menit
    </script>
</body>
</html>
